{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n/* eslint-disable @typescript-eslint/naming-convention */\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockConnectionPointMode } from \"../../Enums/nodeMaterialBlockConnectionPointMode.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\nimport { Matrix, Vector2, Vector3, Vector4 } from \"../../../../Maths/math.vector.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { GetClass, RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { Color3, Color4, TmpColors } from \"../../../../Maths/math.js\";\nimport { AnimatedInputBlockTypes } from \"./animatedInputBlockTypes.js\";\nimport { Observable } from \"../../../../Misc/observable.js\";\nimport { PrecisionDate } from \"../../../../Misc/precisionDate.js\";\nconst remapAttributeName = {\n  position2d: \"position\",\n  particle_uv: \"vUV\",\n  particle_color: \"vColor\",\n  particle_texturemask: \"textureMask\",\n  particle_positionw: \"vPositionW\"\n};\nconst attributeInFragmentOnly = {\n  particle_uv: true,\n  particle_color: true,\n  particle_texturemask: true,\n  particle_positionw: true\n};\nconst attributeAsUniform = {\n  particle_texturemask: true\n};\n/**\n * Block used to expose an input value\n */\nexport class InputBlock extends NodeMaterialBlock {\n  /**\n   * Gets or sets the connection point type (default is float)\n   */\n  get type() {\n    if (this._type === NodeMaterialBlockConnectionPointTypes.AutoDetect) {\n      if (this.isUniform && this.value != null) {\n        if (!isNaN(this.value)) {\n          this._type = NodeMaterialBlockConnectionPointTypes.Float;\n          return this._type;\n        }\n        switch (this.value.getClassName()) {\n          case \"Vector2\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector2;\n            return this._type;\n          case \"Vector3\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\n            return this._type;\n          case \"Vector4\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n            return this._type;\n          case \"Color3\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Color3;\n            return this._type;\n          case \"Color4\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Color4;\n            return this._type;\n          case \"Matrix\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Matrix;\n            return this._type;\n        }\n      }\n      if (this.isAttribute) {\n        switch (this.name) {\n          case \"position\":\n          case \"normal\":\n          case \"particle_positionw\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\n            return this._type;\n          case \"uv\":\n          case \"uv2\":\n          case \"uv3\":\n          case \"uv4\":\n          case \"uv5\":\n          case \"uv6\":\n          case \"position2d\":\n          case \"particle_uv\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector2;\n            return this._type;\n          case \"matricesIndices\":\n          case \"matricesWeights\":\n          case \"matricesIndicesExtra\":\n          case \"matricesWeightsExtra\":\n          case \"world0\":\n          case \"world1\":\n          case \"world2\":\n          case \"world3\":\n          case \"tangent\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n            return this._type;\n          case \"color\":\n          case \"instanceColor\":\n          case \"particle_color\":\n          case \"particle_texturemask\":\n            this._type = NodeMaterialBlockConnectionPointTypes.Color4;\n            return this._type;\n        }\n      }\n      if (this.isSystemValue) {\n        switch (this._systemValue) {\n          case NodeMaterialSystemValues.World:\n          case NodeMaterialSystemValues.WorldView:\n          case NodeMaterialSystemValues.WorldViewProjection:\n          case NodeMaterialSystemValues.View:\n          case NodeMaterialSystemValues.ViewProjection:\n          case NodeMaterialSystemValues.Projection:\n            this._type = NodeMaterialBlockConnectionPointTypes.Matrix;\n            return this._type;\n          case NodeMaterialSystemValues.CameraPosition:\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\n            return this._type;\n          case NodeMaterialSystemValues.FogColor:\n            this._type = NodeMaterialBlockConnectionPointTypes.Color3;\n            return this._type;\n          case NodeMaterialSystemValues.DeltaTime:\n          case NodeMaterialSystemValues.MaterialAlpha:\n            this._type = NodeMaterialBlockConnectionPointTypes.Float;\n            return this._type;\n          case NodeMaterialSystemValues.CameraParameters:\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n            return this._type;\n        }\n      }\n    }\n    return this._type;\n  }\n  /**\n   * Creates a new InputBlock\n   * @param name defines the block name\n   * @param target defines the target of that block (Vertex by default)\n   * @param type defines the type of the input (can be set to NodeMaterialBlockConnectionPointTypes.AutoDetect)\n   */\n  constructor(name, target = NodeMaterialBlockTargets.Vertex, type = NodeMaterialBlockConnectionPointTypes.AutoDetect) {\n    super(name, target, false);\n    this._mode = NodeMaterialBlockConnectionPointMode.Undefined;\n    this._animationType = AnimatedInputBlockTypes.None;\n    /** Gets or set a value used to limit the range of float values */\n    this.min = 0;\n    /** Gets or set a value used to limit the range of float values */\n    this.max = 0;\n    /** Gets or set a value indicating that this input can only get 0 and 1 values */\n    this.isBoolean = false;\n    /** Gets or sets a value used by the Node Material editor to determine how to configure the current value if it is a matrix */\n    this.matrixMode = 0;\n    /** @internal */\n    this._systemValue = null;\n    /** Gets or sets a boolean indicating that the value of this input will not change after a build */\n    this.isConstant = false;\n    /** Gets or sets the group to use to display this block in the Inspector */\n    this.groupInInspector = \"\";\n    /** Gets an observable raised when the value is changed */\n    this.onValueChangedObservable = new Observable();\n    /** Gets or sets a boolean indicating if content needs to be converted to gamma space (for color3/4 only) */\n    this.convertToGammaSpace = false;\n    /** Gets or sets a boolean indicating if content needs to be converted to linear space (for color3/4 only) */\n    this.convertToLinearSpace = false;\n    this._type = type;\n    this.setDefaultValue();\n    this.registerOutput(\"output\", type);\n  }\n  /**\n   * Validates if a name is a reserve word.\n   * @param newName the new name to be given to the node.\n   * @returns false if the name is a reserve word, else true.\n   */\n  validateBlockName(newName) {\n    if (!this.isAttribute) {\n      return super.validateBlockName(newName);\n    }\n    return true;\n  }\n  /**\n   * Gets the output component\n   */\n  get output() {\n    return this._outputs[0];\n  }\n  /**\n   * Set the source of this connection point to a vertex attribute\n   * @param attributeName defines the attribute name (position, uv, normal, etc...). If not specified it will take the connection point name\n   * @returns the current connection point\n   */\n  setAsAttribute(attributeName) {\n    this._mode = NodeMaterialBlockConnectionPointMode.Attribute;\n    if (attributeName) {\n      this.name = attributeName;\n    }\n    return this;\n  }\n  /**\n   * Set the source of this connection point to a system value\n   * @param value define the system value to use (world, view, etc...) or null to switch to manual value\n   * @returns the current connection point\n   */\n  setAsSystemValue(value) {\n    this.systemValue = value;\n    return this;\n  }\n  /**\n   * Gets or sets the value of that point.\n   * Please note that this value will be ignored if valueCallback is defined\n   */\n  get value() {\n    return this._storedValue;\n  }\n  set value(value) {\n    if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\n      if (this.isBoolean) {\n        value = value ? 1 : 0;\n      } else if (this.min !== this.max) {\n        value = Math.max(this.min, value);\n        value = Math.min(this.max, value);\n      }\n    }\n    this._storedValue = value;\n    this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\n    this.onValueChangedObservable.notifyObservers(this);\n  }\n  /**\n   * Gets or sets a callback used to get the value of that point.\n   * Please note that setting this value will force the connection point to ignore the value property\n   */\n  get valueCallback() {\n    return this._valueCallback;\n  }\n  set valueCallback(value) {\n    this._valueCallback = value;\n    this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\n  }\n  /**\n   * Gets or sets the associated variable name in the shader\n   */\n  get associatedVariableName() {\n    return this._associatedVariableName;\n  }\n  set associatedVariableName(value) {\n    this._associatedVariableName = value;\n  }\n  /** Gets or sets the type of animation applied to the input */\n  get animationType() {\n    return this._animationType;\n  }\n  set animationType(value) {\n    this._animationType = value;\n  }\n  /**\n   * Gets a boolean indicating that this connection point not defined yet\n   */\n  get isUndefined() {\n    return this._mode === NodeMaterialBlockConnectionPointMode.Undefined;\n  }\n  /**\n   * Gets or sets a boolean indicating that this connection point is coming from an uniform.\n   * In this case the connection point name must be the name of the uniform to use.\n   * Can only be set on inputs\n   */\n  get isUniform() {\n    return this._mode === NodeMaterialBlockConnectionPointMode.Uniform;\n  }\n  set isUniform(value) {\n    this._mode = value ? NodeMaterialBlockConnectionPointMode.Uniform : NodeMaterialBlockConnectionPointMode.Undefined;\n    this.associatedVariableName = \"\";\n  }\n  /**\n   * Gets or sets a boolean indicating that this connection point is coming from an attribute.\n   * In this case the connection point name must be the name of the attribute to use\n   * Can only be set on inputs\n   */\n  get isAttribute() {\n    return this._mode === NodeMaterialBlockConnectionPointMode.Attribute;\n  }\n  set isAttribute(value) {\n    this._mode = value ? NodeMaterialBlockConnectionPointMode.Attribute : NodeMaterialBlockConnectionPointMode.Undefined;\n    this.associatedVariableName = \"\";\n  }\n  /**\n   * Gets or sets a boolean indicating that this connection point is generating a varying variable.\n   * Can only be set on exit points\n   */\n  get isVarying() {\n    return this._mode === NodeMaterialBlockConnectionPointMode.Varying;\n  }\n  set isVarying(value) {\n    this._mode = value ? NodeMaterialBlockConnectionPointMode.Varying : NodeMaterialBlockConnectionPointMode.Undefined;\n    this.associatedVariableName = \"\";\n  }\n  /**\n   * Gets a boolean indicating that the current connection point is a system value\n   */\n  get isSystemValue() {\n    return this._systemValue != null;\n  }\n  /**\n   * Gets or sets the current well known value or null if not defined as a system value\n   */\n  get systemValue() {\n    return this._systemValue;\n  }\n  set systemValue(value) {\n    this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\n    this.associatedVariableName = \"\";\n    this._systemValue = value;\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"InputBlock\";\n  }\n  /**\n   * Animate the input if animationType !== None\n   * @param scene defines the rendering scene\n   */\n  animate(scene) {\n    switch (this._animationType) {\n      case AnimatedInputBlockTypes.Time:\n        {\n          if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\n            this.value += scene.getAnimationRatio() * 0.01;\n          }\n          break;\n        }\n      case AnimatedInputBlockTypes.RealTime:\n        {\n          if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\n            this.value = (PrecisionDate.Now - scene.getEngine().startTime) / 1000;\n          }\n          break;\n        }\n    }\n  }\n  _emitDefine(define) {\n    if (define[0] === \"!\") {\n      return `#ifndef ${define.substring(1)}\\n`;\n    }\n    return `#ifdef ${define}\\n`;\n  }\n  initialize() {\n    this.associatedVariableName = \"\";\n  }\n  /**\n   * Set the input block to its default value (based on its type)\n   */\n  setDefaultValue() {\n    switch (this.type) {\n      case NodeMaterialBlockConnectionPointTypes.Float:\n        this.value = 0;\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector2:\n        this.value = Vector2.Zero();\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector3:\n        this.value = Vector3.Zero();\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector4:\n        this.value = Vector4.Zero();\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Color3:\n        this.value = Color3.White();\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Color4:\n        this.value = new Color4(1, 1, 1, 1);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Matrix:\n        this.value = Matrix.Identity();\n        break;\n    }\n  }\n  _emitConstant(state) {\n    switch (this.type) {\n      case NodeMaterialBlockConnectionPointTypes.Float:\n        return `${state._emitFloat(this.value)}`;\n      case NodeMaterialBlockConnectionPointTypes.Vector2:\n        return `vec2(${this.value.x}, ${this.value.y})`;\n      case NodeMaterialBlockConnectionPointTypes.Vector3:\n        return `vec3(${this.value.x}, ${this.value.y}, ${this.value.z})`;\n      case NodeMaterialBlockConnectionPointTypes.Vector4:\n        return `vec4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;\n      case NodeMaterialBlockConnectionPointTypes.Color3:\n        TmpColors.Color3[0].set(this.value.r, this.value.g, this.value.b);\n        if (this.convertToGammaSpace) {\n          TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\n        }\n        if (this.convertToLinearSpace) {\n          TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\n        }\n        return `vec3(${TmpColors.Color3[0].r}, ${TmpColors.Color3[0].g}, ${TmpColors.Color3[0].b})`;\n      case NodeMaterialBlockConnectionPointTypes.Color4:\n        TmpColors.Color4[0].set(this.value.r, this.value.g, this.value.b, this.value.a);\n        if (this.convertToGammaSpace) {\n          TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\n        }\n        if (this.convertToLinearSpace) {\n          TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\n        }\n        return `vec4(${TmpColors.Color4[0].r}, ${TmpColors.Color4[0].g}, ${TmpColors.Color4[0].b}, ${TmpColors.Color4[0].a})`;\n    }\n    return \"\";\n  }\n  /** @internal */\n  get _noContextSwitch() {\n    return attributeInFragmentOnly[this.name];\n  }\n  _emit(state, define) {\n    var _a;\n    // Uniforms\n    if (this.isUniform) {\n      if (!this.associatedVariableName) {\n        this.associatedVariableName = state._getFreeVariableName(\"u_\" + this.name);\n      }\n      if (this.isConstant) {\n        if (state.constants.indexOf(this.associatedVariableName) !== -1) {\n          return;\n        }\n        state.constants.push(this.associatedVariableName);\n        state._constantDeclaration += this._declareOutput(this.output, state) + ` = ${this._emitConstant(state)};\\n`;\n        return;\n      }\n      if (state.uniforms.indexOf(this.associatedVariableName) !== -1) {\n        return;\n      }\n      state.uniforms.push(this.associatedVariableName);\n      if (define) {\n        state._uniformDeclaration += this._emitDefine(define);\n      }\n      state._uniformDeclaration += `uniform ${state._getGLType(this.type)} ${this.associatedVariableName};\\n`;\n      if (define) {\n        state._uniformDeclaration += `#endif\\n`;\n      }\n      // well known\n      const hints = state.sharedData.hints;\n      if (this._systemValue !== null && this._systemValue !== undefined) {\n        switch (this._systemValue) {\n          case NodeMaterialSystemValues.WorldView:\n            hints.needWorldViewMatrix = true;\n            break;\n          case NodeMaterialSystemValues.WorldViewProjection:\n            hints.needWorldViewProjectionMatrix = true;\n            break;\n        }\n      } else {\n        if (this._animationType !== AnimatedInputBlockTypes.None) {\n          state.sharedData.animatedInputs.push(this);\n        }\n      }\n      return;\n    }\n    // Attribute\n    if (this.isAttribute) {\n      this.associatedVariableName = (_a = remapAttributeName[this.name]) !== null && _a !== void 0 ? _a : this.name;\n      if (this.target === NodeMaterialBlockTargets.Vertex && state._vertexState) {\n        // Attribute for fragment need to be carried over by varyings\n        if (attributeInFragmentOnly[this.name]) {\n          if (attributeAsUniform[this.name]) {\n            state._emitUniformFromString(this.associatedVariableName, state._getGLType(this.type), define);\n          } else {\n            state._emitVaryingFromString(this.associatedVariableName, state._getGLType(this.type), define);\n          }\n        } else {\n          this._emit(state._vertexState, define);\n        }\n        return;\n      }\n      if (state.attributes.indexOf(this.associatedVariableName) !== -1) {\n        return;\n      }\n      state.attributes.push(this.associatedVariableName);\n      if (attributeInFragmentOnly[this.name]) {\n        if (attributeAsUniform[this.name]) {\n          state._emitUniformFromString(this.associatedVariableName, state._getGLType(this.type), define);\n        } else {\n          state._emitVaryingFromString(this.associatedVariableName, state._getGLType(this.type), define);\n        }\n      } else {\n        if (define) {\n          state._attributeDeclaration += this._emitDefine(define);\n        }\n        state._attributeDeclaration += `attribute ${state._getGLType(this.type)} ${this.associatedVariableName};\\n`;\n        if (define) {\n          state._attributeDeclaration += `#endif\\n`;\n        }\n      }\n    }\n  }\n  /**\n   * @internal\n   */\n  _transmitWorld(effect, world, worldView, worldViewProjection) {\n    if (!this._systemValue) {\n      return;\n    }\n    const variableName = this.associatedVariableName;\n    switch (this._systemValue) {\n      case NodeMaterialSystemValues.World:\n        effect.setMatrix(variableName, world);\n        break;\n      case NodeMaterialSystemValues.WorldView:\n        effect.setMatrix(variableName, worldView);\n        break;\n      case NodeMaterialSystemValues.WorldViewProjection:\n        effect.setMatrix(variableName, worldViewProjection);\n        break;\n    }\n  }\n  /**\n   * @internal\n   */\n  _transmit(effect, scene, material) {\n    if (this.isAttribute) {\n      return;\n    }\n    const variableName = this.associatedVariableName;\n    if (this._systemValue) {\n      switch (this._systemValue) {\n        case NodeMaterialSystemValues.World:\n        case NodeMaterialSystemValues.WorldView:\n        case NodeMaterialSystemValues.WorldViewProjection:\n          return;\n        case NodeMaterialSystemValues.View:\n          effect.setMatrix(variableName, scene.getViewMatrix());\n          break;\n        case NodeMaterialSystemValues.Projection:\n          effect.setMatrix(variableName, scene.getProjectionMatrix());\n          break;\n        case NodeMaterialSystemValues.ViewProjection:\n          effect.setMatrix(variableName, scene.getTransformMatrix());\n          break;\n        case NodeMaterialSystemValues.CameraPosition:\n          scene.bindEyePosition(effect, variableName, true);\n          break;\n        case NodeMaterialSystemValues.FogColor:\n          effect.setColor3(variableName, scene.fogColor);\n          break;\n        case NodeMaterialSystemValues.DeltaTime:\n          effect.setFloat(variableName, scene.deltaTime / 1000.0);\n          break;\n        case NodeMaterialSystemValues.CameraParameters:\n          if (scene.activeCamera) {\n            effect.setFloat4(variableName, scene.getEngine().hasOriginBottomLeft ? -1 : 1, scene.activeCamera.minZ, scene.activeCamera.maxZ, 1 / scene.activeCamera.maxZ);\n          }\n          break;\n        case NodeMaterialSystemValues.MaterialAlpha:\n          effect.setFloat(variableName, material.alpha);\n          break;\n      }\n      return;\n    }\n    const value = this._valueCallback ? this._valueCallback() : this._storedValue;\n    if (value === null) {\n      return;\n    }\n    switch (this.type) {\n      case NodeMaterialBlockConnectionPointTypes.Float:\n        effect.setFloat(variableName, value);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Int:\n        effect.setInt(variableName, value);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Color3:\n        TmpColors.Color3[0].set(this.value.r, this.value.g, this.value.b);\n        if (this.convertToGammaSpace) {\n          TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0], scene.getEngine().useExactSrgbConversions);\n        }\n        if (this.convertToLinearSpace) {\n          TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0], scene.getEngine().useExactSrgbConversions);\n        }\n        effect.setColor3(variableName, TmpColors.Color3[0]);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Color4:\n        TmpColors.Color4[0].set(this.value.r, this.value.g, this.value.b, this.value.a);\n        if (this.convertToGammaSpace) {\n          TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0], scene.getEngine().useExactSrgbConversions);\n        }\n        if (this.convertToLinearSpace) {\n          TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0], scene.getEngine().useExactSrgbConversions);\n        }\n        effect.setDirectColor4(variableName, TmpColors.Color4[0]);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector2:\n        effect.setVector2(variableName, value);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector3:\n        effect.setVector3(variableName, value);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector4:\n        effect.setVector4(variableName, value);\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Matrix:\n        effect.setMatrix(variableName, value);\n        break;\n    }\n  }\n  _buildBlock(state) {\n    super._buildBlock(state);\n    if (this.isUniform || this.isSystemValue) {\n      state.sharedData.inputBlocks.push(this);\n    }\n    this._emit(state);\n  }\n  _dumpPropertiesCode() {\n    const variableName = this._codeVariableName;\n    if (this.isAttribute) {\n      return super._dumpPropertiesCode() + `${variableName}.setAsAttribute(\"${this.name}\");\\n`;\n    }\n    if (this.isSystemValue) {\n      return super._dumpPropertiesCode() + `${variableName}.setAsSystemValue(BABYLON.NodeMaterialSystemValues.${NodeMaterialSystemValues[this._systemValue]});\\n`;\n    }\n    if (this.isUniform) {\n      const codes = [];\n      let valueString = \"\";\n      switch (this.type) {\n        case NodeMaterialBlockConnectionPointTypes.Float:\n          valueString = `${this.value}`;\n          break;\n        case NodeMaterialBlockConnectionPointTypes.Vector2:\n          valueString = `new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;\n          break;\n        case NodeMaterialBlockConnectionPointTypes.Vector3:\n          valueString = `new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;\n          break;\n        case NodeMaterialBlockConnectionPointTypes.Vector4:\n          valueString = `new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;\n          break;\n        case NodeMaterialBlockConnectionPointTypes.Color3:\n          valueString = `new BABYLON.Color3(${this.value.r}, ${this.value.g}, ${this.value.b})`;\n          if (this.convertToGammaSpace) {\n            valueString += \".toGammaSpace()\";\n          }\n          if (this.convertToLinearSpace) {\n            valueString += \".toLinearSpace()\";\n          }\n          break;\n        case NodeMaterialBlockConnectionPointTypes.Color4:\n          valueString = `new BABYLON.Color4(${this.value.r}, ${this.value.g}, ${this.value.b}, ${this.value.a})`;\n          if (this.convertToGammaSpace) {\n            valueString += \".toGammaSpace()\";\n          }\n          if (this.convertToLinearSpace) {\n            valueString += \".toLinearSpace()\";\n          }\n          break;\n        case NodeMaterialBlockConnectionPointTypes.Matrix:\n          valueString = `BABYLON.Matrix.FromArray([${this.value.m}])`;\n          break;\n      }\n      // Common Property \"Value\"\n      codes.push(`${variableName}.value = ${valueString}`);\n      // Float-Value-Specific Properties\n      if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\n        codes.push(`${variableName}.min = ${this.min}`, `${variableName}.max = ${this.max}`, `${variableName}.isBoolean = ${this.isBoolean}`, `${variableName}.matrixMode = ${this.matrixMode}`, `${variableName}.animationType = BABYLON.AnimatedInputBlockTypes.${AnimatedInputBlockTypes[this.animationType]}`);\n      }\n      // Common Property \"Type\"\n      codes.push(`${variableName}.isConstant = ${this.isConstant}`);\n      codes.push(\"\");\n      return super._dumpPropertiesCode() + codes.join(\";\\n\");\n    }\n    return super._dumpPropertiesCode();\n  }\n  dispose() {\n    this.onValueChangedObservable.clear();\n    super.dispose();\n  }\n  serialize() {\n    const serializationObject = super.serialize();\n    serializationObject.type = this.type;\n    serializationObject.mode = this._mode;\n    serializationObject.systemValue = this._systemValue;\n    serializationObject.animationType = this._animationType;\n    serializationObject.min = this.min;\n    serializationObject.max = this.max;\n    serializationObject.isBoolean = this.isBoolean;\n    serializationObject.matrixMode = this.matrixMode;\n    serializationObject.isConstant = this.isConstant;\n    serializationObject.groupInInspector = this.groupInInspector;\n    serializationObject.convertToGammaSpace = this.convertToGammaSpace;\n    serializationObject.convertToLinearSpace = this.convertToLinearSpace;\n    if (this._storedValue != null && this._mode === NodeMaterialBlockConnectionPointMode.Uniform) {\n      if (this._storedValue.asArray) {\n        serializationObject.valueType = \"BABYLON.\" + this._storedValue.getClassName();\n        serializationObject.value = this._storedValue.asArray();\n      } else {\n        serializationObject.valueType = \"number\";\n        serializationObject.value = this._storedValue;\n      }\n    }\n    return serializationObject;\n  }\n  _deserialize(serializationObject, scene, rootUrl) {\n    this._mode = serializationObject.mode;\n    super._deserialize(serializationObject, scene, rootUrl);\n    this._type = serializationObject.type;\n    this._systemValue = serializationObject.systemValue || serializationObject.wellKnownValue;\n    this._animationType = serializationObject.animationType;\n    this.min = serializationObject.min || 0;\n    this.max = serializationObject.max || 0;\n    this.isBoolean = !!serializationObject.isBoolean;\n    this.matrixMode = serializationObject.matrixMode || 0;\n    this.isConstant = !!serializationObject.isConstant;\n    this.groupInInspector = serializationObject.groupInInspector || \"\";\n    this.convertToGammaSpace = !!serializationObject.convertToGammaSpace;\n    this.convertToLinearSpace = !!serializationObject.convertToLinearSpace;\n    // Tangents back compat\n    if (serializationObject.name === \"tangent\" && serializationObject.mode === NodeMaterialBlockConnectionPointMode.Attribute && serializationObject.type === NodeMaterialBlockConnectionPointTypes.Vector3) {\n      this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n    }\n    if (!serializationObject.valueType) {\n      return;\n    }\n    if (serializationObject.valueType === \"number\") {\n      this._storedValue = serializationObject.value;\n    } else {\n      const valueType = GetClass(serializationObject.valueType);\n      if (valueType) {\n        this._storedValue = valueType.FromArray(serializationObject.value);\n      }\n    }\n  }\n}\nRegisterClass(\"BABYLON.InputBlock\", InputBlock);","map":{"version":3,"names":["NodeMaterialBlock","NodeMaterialBlockConnectionPointTypes","NodeMaterialBlockConnectionPointMode","NodeMaterialSystemValues","Matrix","Vector2","Vector3","Vector4","NodeMaterialBlockTargets","GetClass","RegisterClass","Color3","Color4","TmpColors","AnimatedInputBlockTypes","Observable","PrecisionDate","remapAttributeName","position2d","particle_uv","particle_color","particle_texturemask","particle_positionw","attributeInFragmentOnly","attributeAsUniform","InputBlock","type","_type","AutoDetect","isUniform","value","isNaN","Float","getClassName","isAttribute","name","isSystemValue","_systemValue","World","WorldView","WorldViewProjection","View","ViewProjection","Projection","CameraPosition","FogColor","DeltaTime","MaterialAlpha","CameraParameters","constructor","target","Vertex","_mode","Undefined","_animationType","None","min","max","isBoolean","matrixMode","isConstant","groupInInspector","onValueChangedObservable","convertToGammaSpace","convertToLinearSpace","setDefaultValue","registerOutput","validateBlockName","newName","output","_outputs","setAsAttribute","attributeName","Attribute","setAsSystemValue","systemValue","_storedValue","Math","Uniform","notifyObservers","valueCallback","_valueCallback","associatedVariableName","_associatedVariableName","animationType","isUndefined","isVarying","Varying","animate","scene","Time","getAnimationRatio","RealTime","Now","getEngine","startTime","_emitDefine","define","substring","initialize","Zero","White","Identity","_emitConstant","state","_emitFloat","x","y","z","w","set","r","g","b","toGammaSpaceToRef","sharedData","useExactSrgbConversions","toLinearSpaceToRef","a","_noContextSwitch","_emit","_getFreeVariableName","constants","indexOf","push","_constantDeclaration","_declareOutput","uniforms","_uniformDeclaration","_getGLType","hints","undefined","needWorldViewMatrix","needWorldViewProjectionMatrix","animatedInputs","_a","_vertexState","_emitUniformFromString","_emitVaryingFromString","attributes","_attributeDeclaration","_transmitWorld","effect","world","worldView","worldViewProjection","variableName","setMatrix","_transmit","material","getViewMatrix","getProjectionMatrix","getTransformMatrix","bindEyePosition","setColor3","fogColor","setFloat","deltaTime","activeCamera","setFloat4","hasOriginBottomLeft","minZ","maxZ","alpha","Int","setInt","setDirectColor4","setVector2","setVector3","setVector4","_buildBlock","inputBlocks","_dumpPropertiesCode","_codeVariableName","codes","valueString","m","join","dispose","clear","serialize","serializationObject","mode","asArray","valueType","_deserialize","rootUrl","wellKnownValue","FromArray"],"sources":["../../../../../../../dev/core/src/Materials/Node/Blocks/Input/inputBlock.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/naming-convention */\r\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock\";\r\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes\";\r\nimport { NodeMaterialBlockConnectionPointMode } from \"../../Enums/nodeMaterialBlockConnectionPointMode\";\r\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues\";\r\nimport type { Nullable } from \"../../../../types\";\r\nimport type { Effect } from \"../../../../Materials/effect\";\r\nimport { Matrix, Vector2, Vector3, Vector4 } from \"../../../../Maths/math.vector\";\r\nimport type { Scene } from \"../../../../scene\";\r\nimport type { NodeMaterialConnectionPoint } from \"../../nodeMaterialBlockConnectionPoint\";\r\nimport type { NodeMaterialBuildState } from \"../../nodeMaterialBuildState\";\r\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets\";\r\nimport { GetClass, RegisterClass } from \"../../../../Misc/typeStore\";\r\nimport { Color3, Color4, TmpColors } from \"../../../../Maths/math\";\r\nimport { AnimatedInputBlockTypes } from \"./animatedInputBlockTypes\";\r\nimport { Observable } from \"../../../../Misc/observable\";\r\nimport type { NodeMaterial } from \"../../nodeMaterial\";\r\nimport { PrecisionDate } from \"core/Misc/precisionDate\";\r\n\r\nconst remapAttributeName: { [name: string]: string } = {\r\n    position2d: \"position\",\r\n    particle_uv: \"vUV\",\r\n    particle_color: \"vColor\",\r\n    particle_texturemask: \"textureMask\",\r\n    particle_positionw: \"vPositionW\",\r\n};\r\n\r\nconst attributeInFragmentOnly: { [name: string]: boolean } = {\r\n    particle_uv: true,\r\n    particle_color: true,\r\n    particle_texturemask: true,\r\n    particle_positionw: true,\r\n};\r\n\r\nconst attributeAsUniform: { [name: string]: boolean } = {\r\n    particle_texturemask: true,\r\n};\r\n\r\n/**\r\n * Block used to expose an input value\r\n */\r\nexport class InputBlock extends NodeMaterialBlock {\r\n    private _mode = NodeMaterialBlockConnectionPointMode.Undefined;\r\n    private _associatedVariableName: string;\r\n    private _storedValue: any;\r\n    private _valueCallback: () => any;\r\n    private _type: NodeMaterialBlockConnectionPointTypes;\r\n    private _animationType = AnimatedInputBlockTypes.None;\r\n\r\n    /** Gets or set a value used to limit the range of float values */\r\n    public min: number = 0;\r\n\r\n    /** Gets or set a value used to limit the range of float values */\r\n    public max: number = 0;\r\n\r\n    /** Gets or set a value indicating that this input can only get 0 and 1 values */\r\n    public isBoolean: boolean = false;\r\n\r\n    /** Gets or sets a value used by the Node Material editor to determine how to configure the current value if it is a matrix */\r\n    public matrixMode: number = 0;\r\n\r\n    /** @internal */\r\n    public _systemValue: Nullable<NodeMaterialSystemValues> = null;\r\n\r\n    /** Gets or sets a boolean indicating that the value of this input will not change after a build */\r\n    public isConstant = false;\r\n\r\n    /** Gets or sets the group to use to display this block in the Inspector */\r\n    public groupInInspector = \"\";\r\n\r\n    /** Gets an observable raised when the value is changed */\r\n    public onValueChangedObservable = new Observable<InputBlock>();\r\n\r\n    /** Gets or sets a boolean indicating if content needs to be converted to gamma space (for color3/4 only) */\r\n    public convertToGammaSpace = false;\r\n\r\n    /** Gets or sets a boolean indicating if content needs to be converted to linear space (for color3/4 only) */\r\n    public convertToLinearSpace = false;\r\n\r\n    /**\r\n     * Gets or sets the connection point type (default is float)\r\n     */\r\n    public get type(): NodeMaterialBlockConnectionPointTypes {\r\n        if (this._type === NodeMaterialBlockConnectionPointTypes.AutoDetect) {\r\n            if (this.isUniform && this.value != null) {\r\n                if (!isNaN(this.value)) {\r\n                    this._type = NodeMaterialBlockConnectionPointTypes.Float;\r\n                    return this._type;\r\n                }\r\n\r\n                switch (this.value.getClassName()) {\r\n                    case \"Vector2\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector2;\r\n                        return this._type;\r\n                    case \"Vector3\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\r\n                        return this._type;\r\n                    case \"Vector4\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\r\n                        return this._type;\r\n                    case \"Color3\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Color3;\r\n                        return this._type;\r\n                    case \"Color4\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Color4;\r\n                        return this._type;\r\n                    case \"Matrix\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Matrix;\r\n                        return this._type;\r\n                }\r\n            }\r\n\r\n            if (this.isAttribute) {\r\n                switch (this.name) {\r\n                    case \"position\":\r\n                    case \"normal\":\r\n                    case \"particle_positionw\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\r\n                        return this._type;\r\n                    case \"uv\":\r\n                    case \"uv2\":\r\n                    case \"uv3\":\r\n                    case \"uv4\":\r\n                    case \"uv5\":\r\n                    case \"uv6\":\r\n                    case \"position2d\":\r\n                    case \"particle_uv\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector2;\r\n                        return this._type;\r\n                    case \"matricesIndices\":\r\n                    case \"matricesWeights\":\r\n                    case \"matricesIndicesExtra\":\r\n                    case \"matricesWeightsExtra\":\r\n                    case \"world0\":\r\n                    case \"world1\":\r\n                    case \"world2\":\r\n                    case \"world3\":\r\n                    case \"tangent\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\r\n                        return this._type;\r\n                    case \"color\":\r\n                    case \"instanceColor\":\r\n                    case \"particle_color\":\r\n                    case \"particle_texturemask\":\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Color4;\r\n                        return this._type;\r\n                }\r\n            }\r\n\r\n            if (this.isSystemValue) {\r\n                switch (this._systemValue) {\r\n                    case NodeMaterialSystemValues.World:\r\n                    case NodeMaterialSystemValues.WorldView:\r\n                    case NodeMaterialSystemValues.WorldViewProjection:\r\n                    case NodeMaterialSystemValues.View:\r\n                    case NodeMaterialSystemValues.ViewProjection:\r\n                    case NodeMaterialSystemValues.Projection:\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Matrix;\r\n                        return this._type;\r\n                    case NodeMaterialSystemValues.CameraPosition:\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\r\n                        return this._type;\r\n                    case NodeMaterialSystemValues.FogColor:\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Color3;\r\n                        return this._type;\r\n                    case NodeMaterialSystemValues.DeltaTime:\r\n                    case NodeMaterialSystemValues.MaterialAlpha:\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Float;\r\n                        return this._type;\r\n                    case NodeMaterialSystemValues.CameraParameters:\r\n                        this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\r\n                        return this._type;\r\n                }\r\n            }\r\n        }\r\n\r\n        return this._type;\r\n    }\r\n\r\n    /**\r\n     * Creates a new InputBlock\r\n     * @param name defines the block name\r\n     * @param target defines the target of that block (Vertex by default)\r\n     * @param type defines the type of the input (can be set to NodeMaterialBlockConnectionPointTypes.AutoDetect)\r\n     */\r\n    public constructor(name: string, target = NodeMaterialBlockTargets.Vertex, type: NodeMaterialBlockConnectionPointTypes = NodeMaterialBlockConnectionPointTypes.AutoDetect) {\r\n        super(name, target, false);\r\n\r\n        this._type = type;\r\n\r\n        this.setDefaultValue();\r\n\r\n        this.registerOutput(\"output\", type);\r\n    }\r\n\r\n    /**\r\n     * Validates if a name is a reserve word.\r\n     * @param newName the new name to be given to the node.\r\n     * @returns false if the name is a reserve word, else true.\r\n     */\r\n    public validateBlockName(newName: string) {\r\n        if (!this.isAttribute) {\r\n            return super.validateBlockName(newName);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Gets the output component\r\n     */\r\n    public get output(): NodeMaterialConnectionPoint {\r\n        return this._outputs[0];\r\n    }\r\n\r\n    /**\r\n     * Set the source of this connection point to a vertex attribute\r\n     * @param attributeName defines the attribute name (position, uv, normal, etc...). If not specified it will take the connection point name\r\n     * @returns the current connection point\r\n     */\r\n    public setAsAttribute(attributeName?: string): InputBlock {\r\n        this._mode = NodeMaterialBlockConnectionPointMode.Attribute;\r\n        if (attributeName) {\r\n            this.name = attributeName;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set the source of this connection point to a system value\r\n     * @param value define the system value to use (world, view, etc...) or null to switch to manual value\r\n     * @returns the current connection point\r\n     */\r\n    public setAsSystemValue(value: Nullable<NodeMaterialSystemValues>): InputBlock {\r\n        this.systemValue = value;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the value of that point.\r\n     * Please note that this value will be ignored if valueCallback is defined\r\n     */\r\n    public get value(): any {\r\n        return this._storedValue;\r\n    }\r\n\r\n    public set value(value: any) {\r\n        if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\r\n            if (this.isBoolean) {\r\n                value = value ? 1 : 0;\r\n            } else if (this.min !== this.max) {\r\n                value = Math.max(this.min, value);\r\n                value = Math.min(this.max, value);\r\n            }\r\n        }\r\n\r\n        this._storedValue = value;\r\n        this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\r\n\r\n        this.onValueChangedObservable.notifyObservers(this);\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a callback used to get the value of that point.\r\n     * Please note that setting this value will force the connection point to ignore the value property\r\n     */\r\n    public get valueCallback(): () => any {\r\n        return this._valueCallback;\r\n    }\r\n\r\n    public set valueCallback(value: () => any) {\r\n        this._valueCallback = value;\r\n        this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the associated variable name in the shader\r\n     */\r\n    public get associatedVariableName(): string {\r\n        return this._associatedVariableName;\r\n    }\r\n\r\n    public set associatedVariableName(value: string) {\r\n        this._associatedVariableName = value;\r\n    }\r\n\r\n    /** Gets or sets the type of animation applied to the input */\r\n    public get animationType() {\r\n        return this._animationType;\r\n    }\r\n\r\n    public set animationType(value: AnimatedInputBlockTypes) {\r\n        this._animationType = value;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that this connection point not defined yet\r\n     */\r\n    public get isUndefined(): boolean {\r\n        return this._mode === NodeMaterialBlockConnectionPointMode.Undefined;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that this connection point is coming from an uniform.\r\n     * In this case the connection point name must be the name of the uniform to use.\r\n     * Can only be set on inputs\r\n     */\r\n    public get isUniform(): boolean {\r\n        return this._mode === NodeMaterialBlockConnectionPointMode.Uniform;\r\n    }\r\n\r\n    public set isUniform(value: boolean) {\r\n        this._mode = value ? NodeMaterialBlockConnectionPointMode.Uniform : NodeMaterialBlockConnectionPointMode.Undefined;\r\n        this.associatedVariableName = \"\";\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that this connection point is coming from an attribute.\r\n     * In this case the connection point name must be the name of the attribute to use\r\n     * Can only be set on inputs\r\n     */\r\n    public get isAttribute(): boolean {\r\n        return this._mode === NodeMaterialBlockConnectionPointMode.Attribute;\r\n    }\r\n\r\n    public set isAttribute(value: boolean) {\r\n        this._mode = value ? NodeMaterialBlockConnectionPointMode.Attribute : NodeMaterialBlockConnectionPointMode.Undefined;\r\n        this.associatedVariableName = \"\";\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that this connection point is generating a varying variable.\r\n     * Can only be set on exit points\r\n     */\r\n    public get isVarying(): boolean {\r\n        return this._mode === NodeMaterialBlockConnectionPointMode.Varying;\r\n    }\r\n\r\n    public set isVarying(value: boolean) {\r\n        this._mode = value ? NodeMaterialBlockConnectionPointMode.Varying : NodeMaterialBlockConnectionPointMode.Undefined;\r\n        this.associatedVariableName = \"\";\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that the current connection point is a system value\r\n     */\r\n    public get isSystemValue(): boolean {\r\n        return this._systemValue != null;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the current well known value or null if not defined as a system value\r\n     */\r\n    public get systemValue(): Nullable<NodeMaterialSystemValues> {\r\n        return this._systemValue;\r\n    }\r\n\r\n    public set systemValue(value: Nullable<NodeMaterialSystemValues>) {\r\n        this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\r\n        this.associatedVariableName = \"\";\r\n        this._systemValue = value;\r\n    }\r\n\r\n    /**\r\n     * Gets the current class name\r\n     * @returns the class name\r\n     */\r\n    public getClassName() {\r\n        return \"InputBlock\";\r\n    }\r\n\r\n    /**\r\n     * Animate the input if animationType !== None\r\n     * @param scene defines the rendering scene\r\n     */\r\n    public animate(scene: Scene) {\r\n        switch (this._animationType) {\r\n            case AnimatedInputBlockTypes.Time: {\r\n                if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\r\n                    this.value += scene.getAnimationRatio() * 0.01;\r\n                }\r\n                break;\r\n            }\r\n            case AnimatedInputBlockTypes.RealTime: {\r\n                if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\r\n                    this.value = (PrecisionDate.Now - scene.getEngine().startTime) / 1000;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _emitDefine(define: string): string {\r\n        if (define[0] === \"!\") {\r\n            return `#ifndef ${define.substring(1)}\\n`;\r\n        }\r\n\r\n        return `#ifdef ${define}\\n`;\r\n    }\r\n\r\n    public initialize() {\r\n        this.associatedVariableName = \"\";\r\n    }\r\n\r\n    /**\r\n     * Set the input block to its default value (based on its type)\r\n     */\r\n    public setDefaultValue() {\r\n        switch (this.type) {\r\n            case NodeMaterialBlockConnectionPointTypes.Float:\r\n                this.value = 0;\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector2:\r\n                this.value = Vector2.Zero();\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector3:\r\n                this.value = Vector3.Zero();\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector4:\r\n                this.value = Vector4.Zero();\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Color3:\r\n                this.value = Color3.White();\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Color4:\r\n                this.value = new Color4(1, 1, 1, 1);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Matrix:\r\n                this.value = Matrix.Identity();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private _emitConstant(state: NodeMaterialBuildState) {\r\n        switch (this.type) {\r\n            case NodeMaterialBlockConnectionPointTypes.Float:\r\n                return `${state._emitFloat(this.value)}`;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector2:\r\n                return `vec2(${this.value.x}, ${this.value.y})`;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector3:\r\n                return `vec3(${this.value.x}, ${this.value.y}, ${this.value.z})`;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector4:\r\n                return `vec4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;\r\n            case NodeMaterialBlockConnectionPointTypes.Color3:\r\n                TmpColors.Color3[0].set(this.value.r, this.value.g, this.value.b);\r\n                if (this.convertToGammaSpace) {\r\n                    TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                if (this.convertToLinearSpace) {\r\n                    TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                return `vec3(${TmpColors.Color3[0].r}, ${TmpColors.Color3[0].g}, ${TmpColors.Color3[0].b})`;\r\n            case NodeMaterialBlockConnectionPointTypes.Color4:\r\n                TmpColors.Color4[0].set(this.value.r, this.value.g, this.value.b, this.value.a);\r\n                if (this.convertToGammaSpace) {\r\n                    TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                if (this.convertToLinearSpace) {\r\n                    TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0], state.sharedData.scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                return `vec4(${TmpColors.Color4[0].r}, ${TmpColors.Color4[0].g}, ${TmpColors.Color4[0].b}, ${TmpColors.Color4[0].a})`;\r\n        }\r\n\r\n        return \"\";\r\n    }\r\n\r\n    /** @internal */\r\n    public get _noContextSwitch(): boolean {\r\n        return attributeInFragmentOnly[this.name];\r\n    }\r\n\r\n    private _emit(state: NodeMaterialBuildState, define?: string) {\r\n        // Uniforms\r\n        if (this.isUniform) {\r\n            if (!this.associatedVariableName) {\r\n                this.associatedVariableName = state._getFreeVariableName(\"u_\" + this.name);\r\n            }\r\n\r\n            if (this.isConstant) {\r\n                if (state.constants.indexOf(this.associatedVariableName) !== -1) {\r\n                    return;\r\n                }\r\n                state.constants.push(this.associatedVariableName);\r\n                state._constantDeclaration += this._declareOutput(this.output, state) + ` = ${this._emitConstant(state)};\\n`;\r\n                return;\r\n            }\r\n\r\n            if (state.uniforms.indexOf(this.associatedVariableName) !== -1) {\r\n                return;\r\n            }\r\n\r\n            state.uniforms.push(this.associatedVariableName);\r\n            if (define) {\r\n                state._uniformDeclaration += this._emitDefine(define);\r\n            }\r\n            state._uniformDeclaration += `uniform ${state._getGLType(this.type)} ${this.associatedVariableName};\\n`;\r\n            if (define) {\r\n                state._uniformDeclaration += `#endif\\n`;\r\n            }\r\n\r\n            // well known\r\n            const hints = state.sharedData.hints;\r\n            if (this._systemValue !== null && this._systemValue !== undefined) {\r\n                switch (this._systemValue) {\r\n                    case NodeMaterialSystemValues.WorldView:\r\n                        hints.needWorldViewMatrix = true;\r\n                        break;\r\n                    case NodeMaterialSystemValues.WorldViewProjection:\r\n                        hints.needWorldViewProjectionMatrix = true;\r\n                        break;\r\n                }\r\n            } else {\r\n                if (this._animationType !== AnimatedInputBlockTypes.None) {\r\n                    state.sharedData.animatedInputs.push(this);\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        // Attribute\r\n        if (this.isAttribute) {\r\n            this.associatedVariableName = remapAttributeName[this.name] ?? this.name;\r\n\r\n            if (this.target === NodeMaterialBlockTargets.Vertex && state._vertexState) {\r\n                // Attribute for fragment need to be carried over by varyings\r\n                if (attributeInFragmentOnly[this.name]) {\r\n                    if (attributeAsUniform[this.name]) {\r\n                        state._emitUniformFromString(this.associatedVariableName, state._getGLType(this.type), define);\r\n                    } else {\r\n                        state._emitVaryingFromString(this.associatedVariableName, state._getGLType(this.type), define);\r\n                    }\r\n                } else {\r\n                    this._emit(state._vertexState, define);\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (state.attributes.indexOf(this.associatedVariableName) !== -1) {\r\n                return;\r\n            }\r\n\r\n            state.attributes.push(this.associatedVariableName);\r\n\r\n            if (attributeInFragmentOnly[this.name]) {\r\n                if (attributeAsUniform[this.name]) {\r\n                    state._emitUniformFromString(this.associatedVariableName, state._getGLType(this.type), define);\r\n                } else {\r\n                    state._emitVaryingFromString(this.associatedVariableName, state._getGLType(this.type), define);\r\n                }\r\n            } else {\r\n                if (define) {\r\n                    state._attributeDeclaration += this._emitDefine(define);\r\n                }\r\n                state._attributeDeclaration += `attribute ${state._getGLType(this.type)} ${this.associatedVariableName};\\n`;\r\n                if (define) {\r\n                    state._attributeDeclaration += `#endif\\n`;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _transmitWorld(effect: Effect, world: Matrix, worldView: Matrix, worldViewProjection: Matrix) {\r\n        if (!this._systemValue) {\r\n            return;\r\n        }\r\n\r\n        const variableName = this.associatedVariableName;\r\n        switch (this._systemValue) {\r\n            case NodeMaterialSystemValues.World:\r\n                effect.setMatrix(variableName, world);\r\n                break;\r\n            case NodeMaterialSystemValues.WorldView:\r\n                effect.setMatrix(variableName, worldView);\r\n                break;\r\n            case NodeMaterialSystemValues.WorldViewProjection:\r\n                effect.setMatrix(variableName, worldViewProjection);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _transmit(effect: Effect, scene: Scene, material: NodeMaterial) {\r\n        if (this.isAttribute) {\r\n            return;\r\n        }\r\n\r\n        const variableName = this.associatedVariableName;\r\n        if (this._systemValue) {\r\n            switch (this._systemValue) {\r\n                case NodeMaterialSystemValues.World:\r\n                case NodeMaterialSystemValues.WorldView:\r\n                case NodeMaterialSystemValues.WorldViewProjection:\r\n                    return;\r\n                case NodeMaterialSystemValues.View:\r\n                    effect.setMatrix(variableName, scene.getViewMatrix());\r\n                    break;\r\n                case NodeMaterialSystemValues.Projection:\r\n                    effect.setMatrix(variableName, scene.getProjectionMatrix());\r\n                    break;\r\n                case NodeMaterialSystemValues.ViewProjection:\r\n                    effect.setMatrix(variableName, scene.getTransformMatrix());\r\n                    break;\r\n                case NodeMaterialSystemValues.CameraPosition:\r\n                    scene.bindEyePosition(effect, variableName, true);\r\n                    break;\r\n                case NodeMaterialSystemValues.FogColor:\r\n                    effect.setColor3(variableName, scene.fogColor);\r\n                    break;\r\n                case NodeMaterialSystemValues.DeltaTime:\r\n                    effect.setFloat(variableName, scene.deltaTime / 1000.0);\r\n                    break;\r\n                case NodeMaterialSystemValues.CameraParameters:\r\n                    if (scene.activeCamera) {\r\n                        effect.setFloat4(\r\n                            variableName,\r\n                            scene.getEngine().hasOriginBottomLeft ? -1 : 1,\r\n                            scene.activeCamera.minZ,\r\n                            scene.activeCamera.maxZ,\r\n                            1 / scene.activeCamera.maxZ\r\n                        );\r\n                    }\r\n                    break;\r\n                case NodeMaterialSystemValues.MaterialAlpha:\r\n                    effect.setFloat(variableName, material.alpha);\r\n                    break;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const value = this._valueCallback ? this._valueCallback() : this._storedValue;\r\n\r\n        if (value === null) {\r\n            return;\r\n        }\r\n\r\n        switch (this.type) {\r\n            case NodeMaterialBlockConnectionPointTypes.Float:\r\n                effect.setFloat(variableName, value);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Int:\r\n                effect.setInt(variableName, value);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Color3:\r\n                TmpColors.Color3[0].set(this.value.r, this.value.g, this.value.b);\r\n                if (this.convertToGammaSpace) {\r\n                    TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0], scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                if (this.convertToLinearSpace) {\r\n                    TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0], scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                effect.setColor3(variableName, TmpColors.Color3[0]);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Color4:\r\n                TmpColors.Color4[0].set(this.value.r, this.value.g, this.value.b, this.value.a);\r\n                if (this.convertToGammaSpace) {\r\n                    TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0], scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                if (this.convertToLinearSpace) {\r\n                    TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0], scene.getEngine().useExactSrgbConversions);\r\n                }\r\n                effect.setDirectColor4(variableName, TmpColors.Color4[0]);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector2:\r\n                effect.setVector2(variableName, value);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector3:\r\n                effect.setVector3(variableName, value);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Vector4:\r\n                effect.setVector4(variableName, value);\r\n                break;\r\n            case NodeMaterialBlockConnectionPointTypes.Matrix:\r\n                effect.setMatrix(variableName, value);\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected _buildBlock(state: NodeMaterialBuildState) {\r\n        super._buildBlock(state);\r\n\r\n        if (this.isUniform || this.isSystemValue) {\r\n            state.sharedData.inputBlocks.push(this);\r\n        }\r\n\r\n        this._emit(state);\r\n    }\r\n\r\n    protected _dumpPropertiesCode() {\r\n        const variableName = this._codeVariableName;\r\n\r\n        if (this.isAttribute) {\r\n            return super._dumpPropertiesCode() + `${variableName}.setAsAttribute(\"${this.name}\");\\n`;\r\n        }\r\n        if (this.isSystemValue) {\r\n            return super._dumpPropertiesCode() + `${variableName}.setAsSystemValue(BABYLON.NodeMaterialSystemValues.${NodeMaterialSystemValues[this._systemValue!]});\\n`;\r\n        }\r\n        if (this.isUniform) {\r\n            const codes: string[] = [];\r\n\r\n            let valueString = \"\";\r\n\r\n            switch (this.type) {\r\n                case NodeMaterialBlockConnectionPointTypes.Float:\r\n                    valueString = `${this.value}`;\r\n                    break;\r\n                case NodeMaterialBlockConnectionPointTypes.Vector2:\r\n                    valueString = `new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;\r\n                    break;\r\n                case NodeMaterialBlockConnectionPointTypes.Vector3:\r\n                    valueString = `new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;\r\n                    break;\r\n                case NodeMaterialBlockConnectionPointTypes.Vector4:\r\n                    valueString = `new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;\r\n                    break;\r\n                case NodeMaterialBlockConnectionPointTypes.Color3:\r\n                    valueString = `new BABYLON.Color3(${this.value.r}, ${this.value.g}, ${this.value.b})`;\r\n                    if (this.convertToGammaSpace) {\r\n                        valueString += \".toGammaSpace()\";\r\n                    }\r\n                    if (this.convertToLinearSpace) {\r\n                        valueString += \".toLinearSpace()\";\r\n                    }\r\n                    break;\r\n                case NodeMaterialBlockConnectionPointTypes.Color4:\r\n                    valueString = `new BABYLON.Color4(${this.value.r}, ${this.value.g}, ${this.value.b}, ${this.value.a})`;\r\n                    if (this.convertToGammaSpace) {\r\n                        valueString += \".toGammaSpace()\";\r\n                    }\r\n                    if (this.convertToLinearSpace) {\r\n                        valueString += \".toLinearSpace()\";\r\n                    }\r\n                    break;\r\n                case NodeMaterialBlockConnectionPointTypes.Matrix:\r\n                    valueString = `BABYLON.Matrix.FromArray([${(this.value as Matrix).m}])`;\r\n                    break;\r\n            }\r\n\r\n            // Common Property \"Value\"\r\n            codes.push(`${variableName}.value = ${valueString}`);\r\n\r\n            // Float-Value-Specific Properties\r\n            if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\r\n                codes.push(\r\n                    `${variableName}.min = ${this.min}`,\r\n                    `${variableName}.max = ${this.max}`,\r\n                    `${variableName}.isBoolean = ${this.isBoolean}`,\r\n                    `${variableName}.matrixMode = ${this.matrixMode}`,\r\n                    `${variableName}.animationType = BABYLON.AnimatedInputBlockTypes.${AnimatedInputBlockTypes[this.animationType]}`\r\n                );\r\n            }\r\n\r\n            // Common Property \"Type\"\r\n            codes.push(`${variableName}.isConstant = ${this.isConstant}`);\r\n\r\n            codes.push(\"\");\r\n\r\n            return super._dumpPropertiesCode() + codes.join(\";\\n\");\r\n        }\r\n        return super._dumpPropertiesCode();\r\n    }\r\n\r\n    public dispose() {\r\n        this.onValueChangedObservable.clear();\r\n\r\n        super.dispose();\r\n    }\r\n\r\n    public serialize(): any {\r\n        const serializationObject = super.serialize();\r\n\r\n        serializationObject.type = this.type;\r\n        serializationObject.mode = this._mode;\r\n        serializationObject.systemValue = this._systemValue;\r\n        serializationObject.animationType = this._animationType;\r\n        serializationObject.min = this.min;\r\n        serializationObject.max = this.max;\r\n        serializationObject.isBoolean = this.isBoolean;\r\n        serializationObject.matrixMode = this.matrixMode;\r\n        serializationObject.isConstant = this.isConstant;\r\n        serializationObject.groupInInspector = this.groupInInspector;\r\n        serializationObject.convertToGammaSpace = this.convertToGammaSpace;\r\n        serializationObject.convertToLinearSpace = this.convertToLinearSpace;\r\n\r\n        if (this._storedValue != null && this._mode === NodeMaterialBlockConnectionPointMode.Uniform) {\r\n            if (this._storedValue.asArray) {\r\n                serializationObject.valueType = \"BABYLON.\" + this._storedValue.getClassName();\r\n                serializationObject.value = this._storedValue.asArray();\r\n            } else {\r\n                serializationObject.valueType = \"number\";\r\n                serializationObject.value = this._storedValue;\r\n            }\r\n        }\r\n\r\n        return serializationObject;\r\n    }\r\n\r\n    public _deserialize(serializationObject: any, scene: Scene, rootUrl: string) {\r\n        this._mode = serializationObject.mode;\r\n        super._deserialize(serializationObject, scene, rootUrl);\r\n\r\n        this._type = serializationObject.type;\r\n\r\n        this._systemValue = serializationObject.systemValue || serializationObject.wellKnownValue;\r\n        this._animationType = serializationObject.animationType;\r\n        this.min = serializationObject.min || 0;\r\n        this.max = serializationObject.max || 0;\r\n        this.isBoolean = !!serializationObject.isBoolean;\r\n        this.matrixMode = serializationObject.matrixMode || 0;\r\n        this.isConstant = !!serializationObject.isConstant;\r\n        this.groupInInspector = serializationObject.groupInInspector || \"\";\r\n        this.convertToGammaSpace = !!serializationObject.convertToGammaSpace;\r\n        this.convertToLinearSpace = !!serializationObject.convertToLinearSpace;\r\n\r\n        // Tangents back compat\r\n        if (\r\n            serializationObject.name === \"tangent\" &&\r\n            serializationObject.mode === NodeMaterialBlockConnectionPointMode.Attribute &&\r\n            serializationObject.type === NodeMaterialBlockConnectionPointTypes.Vector3\r\n        ) {\r\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\r\n        }\r\n\r\n        if (!serializationObject.valueType) {\r\n            return;\r\n        }\r\n\r\n        if (serializationObject.valueType === \"number\") {\r\n            this._storedValue = serializationObject.value;\r\n        } else {\r\n            const valueType = GetClass(serializationObject.valueType);\r\n\r\n            if (valueType) {\r\n                this._storedValue = valueType.FromArray(serializationObject.value);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nRegisterClass(\"BABYLON.InputBlock\", InputBlock);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}