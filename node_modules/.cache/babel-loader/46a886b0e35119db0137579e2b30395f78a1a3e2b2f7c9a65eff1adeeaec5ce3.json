{"ast":null,"code":"import { ShaderLanguage } from \"../../Materials/shaderLanguage.js\";\nconst varyingRegex = /(flat\\s)?\\s*varying\\s*.*/;\n/** @internal */\nexport class WebGL2ShaderProcessor {\n  constructor() {\n    this.shaderLanguage = ShaderLanguage.GLSL;\n  }\n  attributeProcessor(attribute) {\n    return attribute.replace(\"attribute\", \"in\");\n  }\n  varyingCheck(varying, _isFragment) {\n    return varyingRegex.test(varying);\n  }\n  varyingProcessor(varying, isFragment) {\n    return varying.replace(\"varying\", isFragment ? \"in\" : \"out\");\n  }\n  postProcessor(code, defines, isFragment) {\n    const hasDrawBuffersExtension = code.search(/#extension.+GL_EXT_draw_buffers.+require/) !== -1;\n    // Remove extensions\n    const regex = /#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;\n    code = code.replace(regex, \"\");\n    // Replace instructions\n    code = code.replace(/texture2D\\s*\\(/g, \"texture(\");\n    if (isFragment) {\n      const hasOutput = code.search(/layout *\\(location *= *0\\) *out/g) !== -1;\n      code = code.replace(/texture2DLodEXT\\s*\\(/g, \"textureLod(\");\n      code = code.replace(/textureCubeLodEXT\\s*\\(/g, \"textureLod(\");\n      code = code.replace(/textureCube\\s*\\(/g, \"texture(\");\n      code = code.replace(/gl_FragDepthEXT/g, \"gl_FragDepth\");\n      code = code.replace(/gl_FragColor/g, \"glFragColor\");\n      code = code.replace(/gl_FragData/g, \"glFragData\");\n      code = code.replace(/void\\s+?main\\s*\\(/g, (hasDrawBuffersExtension || hasOutput ? \"\" : \"layout(location = 0) out vec4 glFragColor;\\n\") + \"void main(\");\n    } else {\n      const hasMultiviewExtension = defines.indexOf(\"#define MULTIVIEW\") !== -1;\n      if (hasMultiviewExtension) {\n        return \"#extension GL_OVR_multiview2 : require\\nlayout (num_views = 2) in;\\n\" + code;\n      }\n    }\n    return code;\n  }\n}","map":{"version":3,"names":["ShaderLanguage","varyingRegex","WebGL2ShaderProcessor","constructor","shaderLanguage","GLSL","attributeProcessor","attribute","replace","varyingCheck","varying","_isFragment","test","varyingProcessor","isFragment","postProcessor","code","defines","hasDrawBuffersExtension","search","regex","hasOutput","hasMultiviewExtension","indexOf"],"sources":["../../../../../dev/core/src/Engines/WebGL/webGL2ShaderProcessors.ts"],"sourcesContent":["import { ShaderLanguage } from \"../../Materials/shaderLanguage\";\r\nimport type { IShaderProcessor } from \"../Processors/iShaderProcessor\";\r\n\r\nconst varyingRegex = /(flat\\s)?\\s*varying\\s*.*/;\r\n\r\n/** @internal */\r\nexport class WebGL2ShaderProcessor implements IShaderProcessor {\r\n    public shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    public attributeProcessor(attribute: string) {\r\n        return attribute.replace(\"attribute\", \"in\");\r\n    }\r\n\r\n    public varyingCheck(varying: string, _isFragment: boolean) {\r\n        return varyingRegex.test(varying);\r\n    }\r\n\r\n    public varyingProcessor(varying: string, isFragment: boolean) {\r\n        return varying.replace(\"varying\", isFragment ? \"in\" : \"out\");\r\n    }\r\n\r\n    public postProcessor(code: string, defines: string[], isFragment: boolean) {\r\n        const hasDrawBuffersExtension = code.search(/#extension.+GL_EXT_draw_buffers.+require/) !== -1;\r\n\r\n        // Remove extensions\r\n        const regex = /#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;\r\n        code = code.replace(regex, \"\");\r\n\r\n        // Replace instructions\r\n        code = code.replace(/texture2D\\s*\\(/g, \"texture(\");\r\n        if (isFragment) {\r\n            const hasOutput = code.search(/layout *\\(location *= *0\\) *out/g) !== -1;\r\n\r\n            code = code.replace(/texture2DLodEXT\\s*\\(/g, \"textureLod(\");\r\n            code = code.replace(/textureCubeLodEXT\\s*\\(/g, \"textureLod(\");\r\n            code = code.replace(/textureCube\\s*\\(/g, \"texture(\");\r\n            code = code.replace(/gl_FragDepthEXT/g, \"gl_FragDepth\");\r\n            code = code.replace(/gl_FragColor/g, \"glFragColor\");\r\n            code = code.replace(/gl_FragData/g, \"glFragData\");\r\n            code = code.replace(/void\\s+?main\\s*\\(/g, (hasDrawBuffersExtension || hasOutput ? \"\" : \"layout(location = 0) out vec4 glFragColor;\\n\") + \"void main(\");\r\n        } else {\r\n            const hasMultiviewExtension = defines.indexOf(\"#define MULTIVIEW\") !== -1;\r\n            if (hasMultiviewExtension) {\r\n                return \"#extension GL_OVR_multiview2 : require\\nlayout (num_views = 2) in;\\n\" + code;\r\n            }\r\n        }\r\n\r\n        return code;\r\n    }\r\n}\r\n"],"mappings":"AAAA,SAASA,cAAc,QAAQ,mCAAiC;AAGhE,MAAMC,YAAY,GAAG,0BAA0B;AAE/C;AACA,OAAM,MAAOC,qBAAqB;EAAlCC,YAAA;IACW,KAAAC,cAAc,GAAGJ,cAAc,CAACK,IAAI;EA0C/C;EAxCWC,kBAAkBA,CAACC,SAAiB;IACvC,OAAOA,SAAS,CAACC,OAAO,CAAC,WAAW,EAAE,IAAI,CAAC;EAC/C;EAEOC,YAAYA,CAACC,OAAe,EAAEC,WAAoB;IACrD,OAAOV,YAAY,CAACW,IAAI,CAACF,OAAO,CAAC;EACrC;EAEOG,gBAAgBA,CAACH,OAAe,EAAEI,UAAmB;IACxD,OAAOJ,OAAO,CAACF,OAAO,CAAC,SAAS,EAAEM,UAAU,GAAG,IAAI,GAAG,KAAK,CAAC;EAChE;EAEOC,aAAaA,CAACC,IAAY,EAAEC,OAAiB,EAAEH,UAAmB;IACrE,MAAMI,uBAAuB,GAAGF,IAAI,CAACG,MAAM,CAAC,0CAA0C,CAAC,KAAK,CAAC,CAAC;IAE9F;IACA,MAAMC,KAAK,GAAG,gJAAgJ;IAC9JJ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAACY,KAAK,EAAE,EAAE,CAAC;IAE9B;IACAJ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,iBAAiB,EAAE,UAAU,CAAC;IAClD,IAAIM,UAAU,EAAE;MACZ,MAAMO,SAAS,GAAGL,IAAI,CAACG,MAAM,CAAC,kCAAkC,CAAC,KAAK,CAAC,CAAC;MAExEH,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,uBAAuB,EAAE,aAAa,CAAC;MAC3DQ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,yBAAyB,EAAE,aAAa,CAAC;MAC7DQ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,mBAAmB,EAAE,UAAU,CAAC;MACpDQ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,kBAAkB,EAAE,cAAc,CAAC;MACvDQ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,eAAe,EAAE,aAAa,CAAC;MACnDQ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,cAAc,EAAE,YAAY,CAAC;MACjDQ,IAAI,GAAGA,IAAI,CAACR,OAAO,CAAC,oBAAoB,EAAE,CAACU,uBAAuB,IAAIG,SAAS,GAAG,EAAE,GAAG,8CAA8C,IAAI,YAAY,CAAC;KACzJ,MAAM;MACH,MAAMC,qBAAqB,GAAGL,OAAO,CAACM,OAAO,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;MACzE,IAAID,qBAAqB,EAAE;QACvB,OAAO,sEAAsE,GAAGN,IAAI;;;IAI5F,OAAOA,IAAI;EACf"},"metadata":{},"sourceType":"module","externalDependencies":[]}