{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { RegisterNativeTypeAsync } from \"../../Engines/nativeEngine.js\";\n/** @internal */\nexport class NativeXRFrame {\n  get session() {\n    return this._nativeImpl.session;\n  }\n  constructor(_nativeImpl) {\n    this._nativeImpl = _nativeImpl;\n    this._xrTransform = new XRRigidTransform();\n    this._xrPose = {\n      transform: this._xrTransform,\n      emulatedPosition: false\n    };\n    // Enough space for position, orientation\n    this._xrPoseVectorData = new Float32Array(4 + 4);\n    this.fillPoses = this._nativeImpl.fillPoses.bind(this._nativeImpl);\n    this.getViewerPose = this._nativeImpl.getViewerPose.bind(this._nativeImpl);\n    this.getHitTestResults = this._nativeImpl.getHitTestResults.bind(this._nativeImpl);\n    this.getHitTestResultsForTransientInput = () => {\n      throw new Error(\"XRFrame.getHitTestResultsForTransientInput not supported on native.\");\n    };\n    this.createAnchor = this._nativeImpl.createAnchor.bind(this._nativeImpl);\n    this.getJointPose = this._nativeImpl.getJointPose.bind(this._nativeImpl);\n    this.fillJointRadii = this._nativeImpl.fillJointRadii.bind(this._nativeImpl);\n    this.getLightEstimate = () => {\n      throw new Error(\"XRFrame.getLightEstimate not supported on native.\");\n    };\n    this.getImageTrackingResults = () => {\n      var _a;\n      return (_a = this._nativeImpl._imageTrackingResults) !== null && _a !== void 0 ? _a : [];\n    };\n  }\n  getPose(space, baseSpace) {\n    if (!this._nativeImpl.getPoseData(space, baseSpace, this._xrPoseVectorData.buffer, this._xrTransform.matrix.buffer)) {\n      return undefined;\n    }\n    const position = this._xrTransform.position;\n    position.x = this._xrPoseVectorData[0];\n    position.y = this._xrPoseVectorData[1];\n    position.z = this._xrPoseVectorData[2];\n    position.w = this._xrPoseVectorData[3];\n    const orientation = this._xrTransform.orientation;\n    orientation.x = this._xrPoseVectorData[4];\n    orientation.y = this._xrPoseVectorData[5];\n    orientation.z = this._xrPoseVectorData[6];\n    orientation.w = this._xrPoseVectorData[7];\n    return this._xrPose;\n  }\n  get trackedAnchors() {\n    return this._nativeImpl.trackedAnchors;\n  }\n  get worldInformation() {\n    return this._nativeImpl.worldInformation;\n  }\n  get detectedPlanes() {\n    return this._nativeImpl.detectedPlanes;\n  }\n  get featurePointCloud() {\n    return this._nativeImpl.featurePointCloud;\n  }\n  getDepthInformation(view) {\n    throw new Error(\"This function is not available in Babylon Native\");\n    // return this._nativeImpl.getDepthInformation(view);\n  }\n}\n\nRegisterNativeTypeAsync(\"NativeXRFrame\", NativeXRFrame);","map":{"version":3,"names":["RegisterNativeTypeAsync","NativeXRFrame","session","_nativeImpl","constructor","_xrTransform","XRRigidTransform","_xrPose","transform","emulatedPosition","_xrPoseVectorData","Float32Array","fillPoses","bind","getViewerPose","getHitTestResults","getHitTestResultsForTransientInput","Error","createAnchor","getJointPose","fillJointRadii","getLightEstimate","getImageTrackingResults","_a","_imageTrackingResults","getPose","space","baseSpace","getPoseData","buffer","matrix","undefined","position","x","y","z","w","orientation","trackedAnchors","worldInformation","detectedPlanes","featurePointCloud","getDepthInformation","view"],"sources":["../../../../../dev/core/src/XR/native/nativeXRFrame.ts"],"sourcesContent":["import { RegisterNativeTypeAsync } from \"../../Engines/nativeEngine\";\r\n\r\n/** @internal */\r\ninterface INativeXRFrame extends XRFrame {\r\n    // Native-only helper functions\r\n    getPoseData: (space: XRSpace, baseSpace: XRReferenceSpace, vectorBuffer: ArrayBuffer, matrixBuffer: ArrayBuffer) => XRPose;\r\n    _imageTrackingResults?: XRImageTrackingResult[];\r\n}\r\n\r\n/** @internal */\r\nexport class NativeXRFrame implements XRFrame {\r\n    private readonly _xrTransform = new XRRigidTransform();\r\n    private readonly _xrPose: XRPose = {\r\n        transform: this._xrTransform,\r\n        emulatedPosition: false,\r\n    };\r\n    // Enough space for position, orientation\r\n    private readonly _xrPoseVectorData = new Float32Array(4 + 4);\r\n\r\n    public get session(): XRSession {\r\n        return this._nativeImpl.session;\r\n    }\r\n\r\n    constructor(private _nativeImpl: INativeXRFrame) {}\r\n\r\n    public getPose(space: XRSpace, baseSpace: XRReferenceSpace): XRPose | undefined {\r\n        if (!this._nativeImpl.getPoseData(space, baseSpace, this._xrPoseVectorData.buffer, this._xrTransform.matrix.buffer)) {\r\n            return undefined;\r\n        }\r\n        const position = this._xrTransform.position as DOMPoint;\r\n        position.x = this._xrPoseVectorData[0];\r\n        position.y = this._xrPoseVectorData[1];\r\n        position.z = this._xrPoseVectorData[2];\r\n        position.w = this._xrPoseVectorData[3];\r\n\r\n        const orientation = this._xrTransform.orientation as DOMPoint;\r\n        orientation.x = this._xrPoseVectorData[4];\r\n        orientation.y = this._xrPoseVectorData[5];\r\n        orientation.z = this._xrPoseVectorData[6];\r\n        orientation.w = this._xrPoseVectorData[7];\r\n        return this._xrPose;\r\n    }\r\n\r\n    public readonly fillPoses = this._nativeImpl.fillPoses!.bind(this._nativeImpl);\r\n\r\n    public readonly getViewerPose = this._nativeImpl.getViewerPose.bind(this._nativeImpl);\r\n\r\n    public readonly getHitTestResults = this._nativeImpl.getHitTestResults.bind(this._nativeImpl);\r\n\r\n    public readonly getHitTestResultsForTransientInput = () => {\r\n        throw new Error(\"XRFrame.getHitTestResultsForTransientInput not supported on native.\");\r\n    };\r\n\r\n    public get trackedAnchors(): XRAnchorSet | undefined {\r\n        return this._nativeImpl.trackedAnchors;\r\n    }\r\n\r\n    public readonly createAnchor = this._nativeImpl.createAnchor!.bind(this._nativeImpl);\r\n\r\n    public get worldInformation(): XRWorldInformation | undefined {\r\n        return this._nativeImpl.worldInformation;\r\n    }\r\n\r\n    public get detectedPlanes(): XRPlaneSet | undefined {\r\n        return this._nativeImpl.detectedPlanes;\r\n    }\r\n\r\n    public readonly getJointPose = this._nativeImpl.getJointPose!.bind(this._nativeImpl);\r\n\r\n    public readonly fillJointRadii = this._nativeImpl.fillJointRadii!.bind(this._nativeImpl);\r\n\r\n    public readonly getLightEstimate = () => {\r\n        throw new Error(\"XRFrame.getLightEstimate not supported on native.\");\r\n    };\r\n\r\n    public get featurePointCloud(): number[] | undefined {\r\n        return this._nativeImpl.featurePointCloud;\r\n    }\r\n\r\n    public readonly getImageTrackingResults = (): XRImageTrackingResult[] => {\r\n        return this._nativeImpl._imageTrackingResults ?? [];\r\n    };\r\n\r\n    public getDepthInformation(view: XRView): XRCPUDepthInformation | undefined {\r\n        throw new Error(\"This function is not available in Babylon Native\");\r\n        // return this._nativeImpl.getDepthInformation(view);\r\n    }\r\n}\r\n\r\nRegisterNativeTypeAsync(\"NativeXRFrame\", NativeXRFrame);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}