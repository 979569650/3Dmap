{"ast":null,"code":"import { FollowBehavior } from \"@babylonjs/core/Behaviors/Meshes/followBehavior.js\";\nimport { SixDofDragBehavior } from \"@babylonjs/core/Behaviors/Meshes/sixDofDragBehavior.js\";\nimport { SurfaceMagnetismBehavior } from \"@babylonjs/core/Behaviors/Meshes/surfaceMagnetismBehavior.js\";\n/**\n * Default behavior for 3D UI elements.\n * Handles a FollowBehavior, SixDofBehavior and SurfaceMagnetismBehavior\n * @since 5.0.0\n */\nexport class DefaultBehavior {\n  /**\n   * Instantiates the default behavior\n   */\n  constructor() {\n    /**\n     * Enables the follow behavior\n     */\n    this.followBehaviorEnabled = false;\n    /**\n     * Enables the six DoF drag behavior\n     */\n    this.sixDofDragBehaviorEnabled = true;\n    /**\n     * Enables the surface magnetism behavior\n     */\n    this.surfaceMagnetismBehaviorEnabled = true;\n    this._followBehavior = new FollowBehavior();\n    this._sixDofDragBehavior = new SixDofDragBehavior();\n    this._surfaceMagnetismBehavior = new SurfaceMagnetismBehavior();\n  }\n  /**\n   *  The name of the behavior\n   */\n  get name() {\n    return \"Default\";\n  }\n  /**\n   *  The follow behavior\n   */\n  get followBehavior() {\n    return this._followBehavior;\n  }\n  /**\n   *  The six DoF drag behavior\n   */\n  get sixDofDragBehavior() {\n    return this._sixDofDragBehavior;\n  }\n  /**\n   * The surface magnetism behavior\n   */\n  get surfaceMagnetismBehavior() {\n    return this._surfaceMagnetismBehavior;\n  }\n  /**\n   *  Initializes the behavior\n   */\n  init() {}\n  /**\n   * Attaches the default behavior\n   * @param ownerMesh The top level mesh\n   * @param draggablesMeshes Descendant meshes that can be used for dragging the owner mesh\n   * @param sceneUnderstandingMeshes Meshes from the scene understanding that will be used for surface magnetism\n   */\n  attach(ownerMesh, draggablesMeshes, sceneUnderstandingMeshes) {\n    this._scene = ownerMesh.getScene();\n    this.attachedNode = ownerMesh;\n    this._addObservables();\n    // Since our observables are bound before the child behaviors', ours are called first\n    this._followBehavior.attach(ownerMesh);\n    this._sixDofDragBehavior.attach(ownerMesh);\n    this._sixDofDragBehavior.draggableMeshes = draggablesMeshes || null;\n    this._sixDofDragBehavior.faceCameraOnDragStart = true;\n    this._surfaceMagnetismBehavior.attach(ownerMesh, this._scene);\n    if (sceneUnderstandingMeshes) {\n      this._surfaceMagnetismBehavior.meshes = sceneUnderstandingMeshes;\n    }\n    // We disable this behavior because we will handle pose changing event manually with sixDofDragBehavior\n    this._surfaceMagnetismBehavior.enabled = false;\n  }\n  /**\n   *  Detaches the behavior from the mesh\n   */\n  detach() {\n    this.attachedNode = null;\n    this._removeObservables();\n    this._followBehavior.detach();\n    this._sixDofDragBehavior.detach();\n    this._surfaceMagnetismBehavior.detach();\n  }\n  _addObservables() {\n    this._onBeforeRenderObserver = this._scene.onBeforeRenderObservable.add(() => {\n      this._followBehavior._enabled = !this._sixDofDragBehavior.isMoving && this.followBehaviorEnabled;\n    });\n    this._onDragObserver = this._sixDofDragBehavior.onDragObservable.add(event => {\n      this._sixDofDragBehavior.disableMovement = this._surfaceMagnetismBehavior.findAndUpdateTarget(event.pickInfo);\n    });\n  }\n  _removeObservables() {\n    this._scene.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);\n    this._sixDofDragBehavior.onDragObservable.remove(this._onDragObserver);\n  }\n}","map":{"version":3,"names":["FollowBehavior","SixDofDragBehavior","SurfaceMagnetismBehavior","DefaultBehavior","constructor","followBehaviorEnabled","sixDofDragBehaviorEnabled","surfaceMagnetismBehaviorEnabled","_followBehavior","_sixDofDragBehavior","_surfaceMagnetismBehavior","name","followBehavior","sixDofDragBehavior","surfaceMagnetismBehavior","init","attach","ownerMesh","draggablesMeshes","sceneUnderstandingMeshes","_scene","getScene","attachedNode","_addObservables","draggableMeshes","faceCameraOnDragStart","meshes","enabled","detach","_removeObservables","_onBeforeRenderObserver","onBeforeRenderObservable","add","_enabled","isMoving","_onDragObserver","onDragObservable","event","disableMovement","findAndUpdateTarget","pickInfo","remove"],"sources":["../../../../../dev/gui/src/3D/behaviors/defaultBehavior.ts"],"sourcesContent":["import type { Behavior } from \"core/Behaviors/behavior\";\r\nimport { FollowBehavior } from \"core/Behaviors/Meshes/followBehavior\";\r\nimport { SixDofDragBehavior } from \"core/Behaviors/Meshes/sixDofDragBehavior\";\r\nimport type { Scene } from \"core/scene\";\r\nimport type { Mesh } from \"core/Meshes/mesh\";\r\nimport type { Observer } from \"core/Misc/observable\";\r\nimport type { Nullable } from \"core/types\";\r\nimport { SurfaceMagnetismBehavior } from \"core/Behaviors/Meshes/surfaceMagnetismBehavior\";\r\nimport type { Vector3 } from \"core/Maths/math.vector\";\r\nimport type { PickingInfo } from \"core/Collisions/pickingInfo\";\r\nimport type { AbstractMesh } from \"core/Meshes/abstractMesh\";\r\n\r\n/**\r\n * Default behavior for 3D UI elements.\r\n * Handles a FollowBehavior, SixDofBehavior and SurfaceMagnetismBehavior\r\n * @since 5.0.0\r\n */\r\nexport class DefaultBehavior implements Behavior<Mesh> {\r\n    private _scene: Scene;\r\n    private _followBehavior: FollowBehavior;\r\n    private _sixDofDragBehavior: SixDofDragBehavior;\r\n    private _surfaceMagnetismBehavior: SurfaceMagnetismBehavior;\r\n    private _onBeforeRenderObserver: Nullable<Observer<Scene>>;\r\n    private _onDragObserver: Nullable<Observer<{ delta: Vector3; position: Vector3; pickInfo: PickingInfo }>>;\r\n\r\n    /**\r\n     * Instantiates the default behavior\r\n     */\r\n    constructor() {\r\n        this._followBehavior = new FollowBehavior();\r\n        this._sixDofDragBehavior = new SixDofDragBehavior();\r\n        this._surfaceMagnetismBehavior = new SurfaceMagnetismBehavior();\r\n    }\r\n\r\n    /**\r\n     * Attached node of this behavior\r\n     */\r\n    public attachedNode: Nullable<Mesh>;\r\n\r\n    /**\r\n     *  The name of the behavior\r\n     */\r\n    public get name(): string {\r\n        return \"Default\";\r\n    }\r\n\r\n    /**\r\n     *  The follow behavior\r\n     */\r\n    public get followBehavior(): FollowBehavior {\r\n        return this._followBehavior;\r\n    }\r\n\r\n    /**\r\n     *  The six DoF drag behavior\r\n     */\r\n    public get sixDofDragBehavior(): SixDofDragBehavior {\r\n        return this._sixDofDragBehavior;\r\n    }\r\n\r\n    /**\r\n     * The surface magnetism behavior\r\n     */\r\n    public get surfaceMagnetismBehavior(): SurfaceMagnetismBehavior {\r\n        return this._surfaceMagnetismBehavior;\r\n    }\r\n\r\n    /**\r\n     * Enables the follow behavior\r\n     */\r\n    public followBehaviorEnabled: boolean = false;\r\n\r\n    /**\r\n     * Enables the six DoF drag behavior\r\n     */\r\n    public sixDofDragBehaviorEnabled: boolean = true;\r\n\r\n    /**\r\n     * Enables the surface magnetism behavior\r\n     */\r\n    public surfaceMagnetismBehaviorEnabled: boolean = true;\r\n\r\n    /**\r\n     *  Initializes the behavior\r\n     */\r\n    public init() {}\r\n\r\n    /**\r\n     * Attaches the default behavior\r\n     * @param ownerMesh The top level mesh\r\n     * @param draggablesMeshes Descendant meshes that can be used for dragging the owner mesh\r\n     * @param sceneUnderstandingMeshes Meshes from the scene understanding that will be used for surface magnetism\r\n     */\r\n    public attach(ownerMesh: Mesh, draggablesMeshes?: Mesh[], sceneUnderstandingMeshes?: AbstractMesh[]): void {\r\n        this._scene = ownerMesh.getScene();\r\n        this.attachedNode = ownerMesh;\r\n\r\n        this._addObservables();\r\n        // Since our observables are bound before the child behaviors', ours are called first\r\n        this._followBehavior.attach(ownerMesh);\r\n        this._sixDofDragBehavior.attach(ownerMesh);\r\n        this._sixDofDragBehavior.draggableMeshes = draggablesMeshes || null;\r\n        this._sixDofDragBehavior.faceCameraOnDragStart = true;\r\n        this._surfaceMagnetismBehavior.attach(ownerMesh, this._scene);\r\n        if (sceneUnderstandingMeshes) {\r\n            this._surfaceMagnetismBehavior.meshes = sceneUnderstandingMeshes;\r\n        }\r\n\r\n        // We disable this behavior because we will handle pose changing event manually with sixDofDragBehavior\r\n        this._surfaceMagnetismBehavior.enabled = false;\r\n    }\r\n\r\n    /**\r\n     *  Detaches the behavior from the mesh\r\n     */\r\n    public detach(): void {\r\n        this.attachedNode = null;\r\n        this._removeObservables();\r\n        this._followBehavior.detach();\r\n        this._sixDofDragBehavior.detach();\r\n        this._surfaceMagnetismBehavior.detach();\r\n    }\r\n\r\n    private _addObservables() {\r\n        this._onBeforeRenderObserver = this._scene.onBeforeRenderObservable.add(() => {\r\n            this._followBehavior._enabled = !this._sixDofDragBehavior.isMoving && this.followBehaviorEnabled;\r\n        });\r\n        this._onDragObserver = this._sixDofDragBehavior.onDragObservable.add((event: { pickInfo: PickingInfo }) => {\r\n            this._sixDofDragBehavior.disableMovement = this._surfaceMagnetismBehavior.findAndUpdateTarget(event.pickInfo);\r\n        });\r\n    }\r\n\r\n    private _removeObservables() {\r\n        this._scene.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);\r\n        this._sixDofDragBehavior.onDragObservable.remove(this._onDragObserver);\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}