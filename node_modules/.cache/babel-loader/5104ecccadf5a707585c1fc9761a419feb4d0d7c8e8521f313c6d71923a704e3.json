{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Vector3 } from \"../../Maths/math.vector.js\";\nimport { PhysicsRaycastResult } from \"../physicsRaycastResult.js\";\nimport { _WarnImport } from \"../../Misc/devTools.js\";\n/**\n * Class used to control physics engine\n * @see https://doc.babylonjs.com/features/featuresDeepDive/physics/usingPhysicsEngine\n */\nexport class PhysicsEngine {\n  /**\n   *\n   * @returns physics plugin version\n   */\n  getPluginVersion() {\n    return this._physicsPlugin.getPluginVersion();\n  }\n  /**\n   * Factory used to create the default physics plugin.\n   * @returns The default physics plugin\n   */\n  static DefaultPluginFactory() {\n    throw _WarnImport(\"\");\n  }\n  /**\n   * Creates a new Physics Engine\n   * @param gravity defines the gravity vector used by the simulation\n   * @param _physicsPlugin defines the plugin to use (CannonJS by default)\n   */\n  constructor(gravity, _physicsPlugin = PhysicsEngine.DefaultPluginFactory()) {\n    this._physicsPlugin = _physicsPlugin;\n    /** @internal */\n    this._physicsBodies = [];\n    this._subTimeStep = 0;\n    gravity = gravity || new Vector3(0, -9.807, 0);\n    this.setGravity(gravity);\n    this.setTimeStep();\n  }\n  /**\n   * Sets the gravity vector used by the simulation\n   * @param gravity defines the gravity vector to use\n   */\n  setGravity(gravity) {\n    this.gravity = gravity;\n    this._physicsPlugin.setGravity(this.gravity);\n  }\n  /**\n   * Set the time step of the physics engine.\n   * Default is 1/60.\n   * To slow it down, enter 1/600 for example.\n   * To speed it up, 1/30\n   * @param newTimeStep defines the new timestep to apply to this world.\n   */\n  setTimeStep(newTimeStep = 1 / 60) {\n    this._physicsPlugin.setTimeStep(newTimeStep);\n  }\n  /**\n   * Get the time step of the physics engine.\n   * @returns the current time step\n   */\n  getTimeStep() {\n    return this._physicsPlugin.getTimeStep();\n  }\n  /**\n   * Set the sub time step of the physics engine.\n   * Default is 0 meaning there is no sub steps\n   * To increase physics resolution precision, set a small value (like 1 ms)\n   * @param subTimeStep defines the new sub timestep used for physics resolution.\n   */\n  setSubTimeStep(subTimeStep = 0) {\n    this._subTimeStep = subTimeStep;\n  }\n  /**\n   * Get the sub time step of the physics engine.\n   * @returns the current sub time step\n   */\n  getSubTimeStep() {\n    return this._subTimeStep;\n  }\n  /**\n   * Release all resources\n   */\n  dispose() {\n    this._physicsPlugin.dispose();\n  }\n  /**\n   * Gets the name of the current physics plugin\n   * @returns the name of the plugin\n   */\n  getPhysicsPluginName() {\n    return this._physicsPlugin.name;\n  }\n  /**\n   * Adding a new impostor for the impostor tracking.\n   * This will be done by the impostor itself.\n   * @param impostor the impostor to add\n   */\n  /**\n   * Called by the scene. No need to call it.\n   * @param delta defines the timespan between frames\n   */\n  _step(delta) {\n    if (delta > 0.1) {\n      delta = 0.1;\n    } else if (delta <= 0) {\n      delta = 1.0 / 60.0;\n    }\n    this._physicsPlugin.executeStep(delta, this._physicsBodies);\n  }\n  /**\n   * Add a body as an active component of this engine\n   * @param body\n   */\n  addBody(physicsBody) {\n    this._physicsBodies.push(physicsBody);\n  }\n  /**\n   * Removes a particular body from this engine\n   */\n  removeBody(physicsBody) {\n    const index = this._physicsBodies.indexOf(physicsBody);\n    if (index > -1) {\n      /*const removed =*/this._physicsBodies.splice(index, 1);\n    }\n  }\n  /**\n   * Returns an array of bodies added to this engine\n    */\n  getBodies() {\n    return this._physicsBodies;\n  }\n  /**\n   * Gets the current plugin used to run the simulation\n   * @returns current plugin\n   */\n  getPhysicsPlugin() {\n    return this._physicsPlugin;\n  }\n  /**\n   * Does a raycast in the physics world\n   * @param from when should the ray start?\n   * @param to when should the ray end?\n   * @param result resulting PhysicsRaycastResult\n   */\n  raycastToRef(from, to, result, query) {\n    this._physicsPlugin.raycast(from, to, result, query);\n  }\n  /**\n   * Does a raycast in the physics world\n   * @param from when should the ray start?\n   * @param to when should the ray end?\n   * @returns PhysicsRaycastResult\n   */\n  raycast(from, to, query) {\n    const result = new PhysicsRaycastResult();\n    this._physicsPlugin.raycast(from, to, result, query);\n    return result;\n  }\n}","map":{"version":3,"names":["Vector3","PhysicsRaycastResult","_WarnImport","PhysicsEngine","getPluginVersion","_physicsPlugin","DefaultPluginFactory","constructor","gravity","_physicsBodies","_subTimeStep","setGravity","setTimeStep","newTimeStep","getTimeStep","setSubTimeStep","subTimeStep","getSubTimeStep","dispose","getPhysicsPluginName","name","_step","delta","executeStep","addBody","physicsBody","push","removeBody","index","indexOf","splice","getBodies","getPhysicsPlugin","raycastToRef","from","to","result","query","raycast"],"sources":["../../../../../dev/core/src/Physics/v2/physicsEngine.ts"],"sourcesContent":["import type { Nullable } from \"../../types\";\r\nimport { Vector3 } from \"../../Maths/math.vector\";\r\nimport type { IPhysicsEngine } from \"../IPhysicsEngine\";\r\nimport type { IPhysicsEnginePluginV2 } from \"./IPhysicsEnginePlugin\";\r\nimport type { IRaycastQuery } from \"../physicsRaycastResult\";\r\nimport { PhysicsRaycastResult } from \"../physicsRaycastResult\";\r\nimport { _WarnImport } from \"../../Misc/devTools\";\r\nimport type { PhysicsBody } from \"./physicsBody\";\r\n\r\n/**\r\n * Class used to control physics engine\r\n * @see https://doc.babylonjs.com/features/featuresDeepDive/physics/usingPhysicsEngine\r\n */\r\nexport class PhysicsEngine implements IPhysicsEngine {\r\n    /** @internal */\r\n    private _physicsBodies: Array<PhysicsBody> = [];\r\n    private _subTimeStep: number = 0;\r\n\r\n    /**\r\n     * Gets the gravity vector used by the simulation\r\n     */\r\n    public gravity: Vector3;\r\n\r\n    /**\r\n     *\r\n     * @returns physics plugin version\r\n     */\r\n    public getPluginVersion(): number {\r\n        return this._physicsPlugin.getPluginVersion();\r\n    }\r\n    /**\r\n     * Factory used to create the default physics plugin.\r\n     * @returns The default physics plugin\r\n     */\r\n    public static DefaultPluginFactory(): IPhysicsEnginePluginV2 {\r\n        throw _WarnImport(\"\");\r\n    }\r\n\r\n    /**\r\n     * Creates a new Physics Engine\r\n     * @param gravity defines the gravity vector used by the simulation\r\n     * @param _physicsPlugin defines the plugin to use (CannonJS by default)\r\n     */\r\n    constructor(gravity: Nullable<Vector3>, private _physicsPlugin: IPhysicsEnginePluginV2 = PhysicsEngine.DefaultPluginFactory()) {\r\n        gravity = gravity || new Vector3(0, -9.807, 0);\r\n        this.setGravity(gravity);\r\n        this.setTimeStep();\r\n    }\r\n\r\n    /**\r\n     * Sets the gravity vector used by the simulation\r\n     * @param gravity defines the gravity vector to use\r\n     */\r\n    public setGravity(gravity: Vector3): void {\r\n        this.gravity = gravity;\r\n        this._physicsPlugin.setGravity(this.gravity);\r\n    }\r\n\r\n    /**\r\n     * Set the time step of the physics engine.\r\n     * Default is 1/60.\r\n     * To slow it down, enter 1/600 for example.\r\n     * To speed it up, 1/30\r\n     * @param newTimeStep defines the new timestep to apply to this world.\r\n     */\r\n    public setTimeStep(newTimeStep: number = 1 / 60) {\r\n        this._physicsPlugin.setTimeStep(newTimeStep);\r\n    }\r\n\r\n    /**\r\n     * Get the time step of the physics engine.\r\n     * @returns the current time step\r\n     */\r\n    public getTimeStep(): number {\r\n        return this._physicsPlugin.getTimeStep();\r\n    }\r\n\r\n    /**\r\n     * Set the sub time step of the physics engine.\r\n     * Default is 0 meaning there is no sub steps\r\n     * To increase physics resolution precision, set a small value (like 1 ms)\r\n     * @param subTimeStep defines the new sub timestep used for physics resolution.\r\n     */\r\n    public setSubTimeStep(subTimeStep: number = 0) {\r\n        this._subTimeStep = subTimeStep;\r\n    }\r\n\r\n    /**\r\n     * Get the sub time step of the physics engine.\r\n     * @returns the current sub time step\r\n     */\r\n    public getSubTimeStep() {\r\n        return this._subTimeStep;\r\n    }\r\n\r\n    /**\r\n     * Release all resources\r\n     */\r\n    public dispose(): void {\r\n        this._physicsPlugin.dispose();\r\n    }\r\n\r\n    /**\r\n     * Gets the name of the current physics plugin\r\n     * @returns the name of the plugin\r\n     */\r\n    public getPhysicsPluginName(): string {\r\n        return this._physicsPlugin.name;\r\n    }\r\n\r\n    /**\r\n     * Adding a new impostor for the impostor tracking.\r\n     * This will be done by the impostor itself.\r\n     * @param impostor the impostor to add\r\n     */\r\n\r\n    /**\r\n     * Called by the scene. No need to call it.\r\n     * @param delta defines the timespan between frames\r\n     */\r\n    public _step(delta: number) {\r\n        if (delta > 0.1) {\r\n            delta = 0.1;\r\n        } else if (delta <= 0) {\r\n            delta = 1.0 / 60.0;\r\n        }\r\n\r\n        this._physicsPlugin.executeStep(delta, this._physicsBodies);\r\n    }\r\n\r\n    /**\r\n     * Add a body as an active component of this engine\r\n     * @param body\r\n     */\r\n    public addBody(physicsBody: PhysicsBody): void {\r\n        this._physicsBodies.push(physicsBody);\r\n    }\r\n    /**\r\n     * Removes a particular body from this engine\r\n     */\r\n    public removeBody(physicsBody: PhysicsBody): void {\r\n        const index = this._physicsBodies.indexOf(physicsBody);\r\n        if (index > -1) {\r\n            /*const removed =*/ this._physicsBodies.splice(index, 1);\r\n        }\r\n    }\r\n    /**\r\n     * Returns an array of bodies added to this engine\r\n\r\n     */\r\n    public getBodies(): Array<PhysicsBody> {\r\n        return this._physicsBodies;\r\n    }\r\n\r\n    /**\r\n     * Gets the current plugin used to run the simulation\r\n     * @returns current plugin\r\n     */\r\n    public getPhysicsPlugin(): IPhysicsEnginePluginV2 {\r\n        return this._physicsPlugin;\r\n    }\r\n\r\n    /**\r\n     * Does a raycast in the physics world\r\n     * @param from when should the ray start?\r\n     * @param to when should the ray end?\r\n     * @param result resulting PhysicsRaycastResult\r\n     */\r\n    public raycastToRef(from: Vector3, to: Vector3, result: PhysicsRaycastResult, query?: IRaycastQuery): void {\r\n        this._physicsPlugin.raycast(from, to, result, query);\r\n    }\r\n\r\n    /**\r\n     * Does a raycast in the physics world\r\n     * @param from when should the ray start?\r\n     * @param to when should the ray end?\r\n     * @returns PhysicsRaycastResult\r\n     */\r\n    public raycast(from: Vector3, to: Vector3, query?: IRaycastQuery): PhysicsRaycastResult {\r\n        const result = new PhysicsRaycastResult();\r\n        this._physicsPlugin.raycast(from, to, result, query);\r\n        return result;\r\n    }\r\n}\r\n"],"mappings":";AACA,SAASA,OAAO,QAAQ,4BAA0B;AAIlD,SAASC,oBAAoB,QAAQ,4BAA0B;AAC/D,SAASC,WAAW,QAAQ,wBAAsB;AAGlD;;;;AAIA,OAAM,MAAOC,aAAa;EAUtB;;;;EAIOC,gBAAgBA,CAAA;IACnB,OAAO,IAAI,CAACC,cAAc,CAACD,gBAAgB,EAAE;EACjD;EACA;;;;EAIO,OAAOE,oBAAoBA,CAAA;IAC9B,MAAMJ,WAAW,CAAC,EAAE,CAAC;EACzB;EAEA;;;;;EAKAK,YAAYC,OAA0B,EAAUH,cAAA,GAAyCF,aAAa,CAACG,oBAAoB,EAAE;IAA7E,KAAAD,cAAc,GAAdA,cAAc;IA7B9D;IACQ,KAAAI,cAAc,GAAuB,EAAE;IACvC,KAAAC,YAAY,GAAW,CAAC;IA4B5BF,OAAO,GAAGA,OAAO,IAAI,IAAIR,OAAO,CAAC,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC;IAC9C,IAAI,CAACW,UAAU,CAACH,OAAO,CAAC;IACxB,IAAI,CAACI,WAAW,EAAE;EACtB;EAEA;;;;EAIOD,UAAUA,CAACH,OAAgB;IAC9B,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACH,cAAc,CAACM,UAAU,CAAC,IAAI,CAACH,OAAO,CAAC;EAChD;EAEA;;;;;;;EAOOI,WAAWA,CAACC,WAAA,GAAsB,CAAC,GAAG,EAAE;IAC3C,IAAI,CAACR,cAAc,CAACO,WAAW,CAACC,WAAW,CAAC;EAChD;EAEA;;;;EAIOC,WAAWA,CAAA;IACd,OAAO,IAAI,CAACT,cAAc,CAACS,WAAW,EAAE;EAC5C;EAEA;;;;;;EAMOC,cAAcA,CAACC,WAAA,GAAsB,CAAC;IACzC,IAAI,CAACN,YAAY,GAAGM,WAAW;EACnC;EAEA;;;;EAIOC,cAAcA,CAAA;IACjB,OAAO,IAAI,CAACP,YAAY;EAC5B;EAEA;;;EAGOQ,OAAOA,CAAA;IACV,IAAI,CAACb,cAAc,CAACa,OAAO,EAAE;EACjC;EAEA;;;;EAIOC,oBAAoBA,CAAA;IACvB,OAAO,IAAI,CAACd,cAAc,CAACe,IAAI;EACnC;EAEA;;;;;EAMA;;;;EAIOC,KAAKA,CAACC,KAAa;IACtB,IAAIA,KAAK,GAAG,GAAG,EAAE;MACbA,KAAK,GAAG,GAAG;KACd,MAAM,IAAIA,KAAK,IAAI,CAAC,EAAE;MACnBA,KAAK,GAAG,GAAG,GAAG,IAAI;;IAGtB,IAAI,CAACjB,cAAc,CAACkB,WAAW,CAACD,KAAK,EAAE,IAAI,CAACb,cAAc,CAAC;EAC/D;EAEA;;;;EAIOe,OAAOA,CAACC,WAAwB;IACnC,IAAI,CAAChB,cAAc,CAACiB,IAAI,CAACD,WAAW,CAAC;EACzC;EACA;;;EAGOE,UAAUA,CAACF,WAAwB;IACtC,MAAMG,KAAK,GAAG,IAAI,CAACnB,cAAc,CAACoB,OAAO,CAACJ,WAAW,CAAC;IACtD,IAAIG,KAAK,GAAG,CAAC,CAAC,EAAE;MACZ,mBAAoB,IAAI,CAACnB,cAAc,CAACqB,MAAM,CAACF,KAAK,EAAE,CAAC,CAAC;;EAEhE;EACA;;;EAIOG,SAASA,CAAA;IACZ,OAAO,IAAI,CAACtB,cAAc;EAC9B;EAEA;;;;EAIOuB,gBAAgBA,CAAA;IACnB,OAAO,IAAI,CAAC3B,cAAc;EAC9B;EAEA;;;;;;EAMO4B,YAAYA,CAACC,IAAa,EAAEC,EAAW,EAAEC,MAA4B,EAAEC,KAAqB;IAC/F,IAAI,CAAChC,cAAc,CAACiC,OAAO,CAACJ,IAAI,EAAEC,EAAE,EAAEC,MAAM,EAAEC,KAAK,CAAC;EACxD;EAEA;;;;;;EAMOC,OAAOA,CAACJ,IAAa,EAAEC,EAAW,EAAEE,KAAqB;IAC5D,MAAMD,MAAM,GAAG,IAAInC,oBAAoB,EAAE;IACzC,IAAI,CAACI,cAAc,CAACiC,OAAO,CAACJ,IAAI,EAAEC,EAAE,EAAEC,MAAM,EAAEC,KAAK,CAAC;IACpD,OAAOD,MAAM;EACjB"},"metadata":{},"sourceType":"module","externalDependencies":[]}