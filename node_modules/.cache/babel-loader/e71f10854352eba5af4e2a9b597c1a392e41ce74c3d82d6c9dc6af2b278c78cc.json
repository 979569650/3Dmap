{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { Observable } from \"./observable.js\";\nimport { GetDOMTextContent, IsNavigatorAvailable, IsWindowObjectExist } from \"./domManagement.js\";\nimport { Logger } from \"./logger.js\";\nimport { DeepCopier } from \"./deepCopier.js\";\nimport { PrecisionDate } from \"./precisionDate.js\";\nimport { _WarnImport } from \"./devTools.js\";\nimport { WebRequest } from \"./webRequest.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\nimport { FileToolsOptions, DecodeBase64UrlToBinary, IsBase64DataUrl, LoadFile as FileToolsLoadFile, LoadImage as FileToolLoadImage, ReadFile as FileToolsReadFile, SetCorsBehavior } from \"./fileTools.js\";\nimport { TimingTools } from \"./timingTools.js\";\nimport { InstantiationTools } from \"./instantiationTools.js\";\nimport { RandomGUID } from \"./guid.js\";\n/**\n * Class containing a set of static utilities functions\n */\nexport class Tools {\n  /**\n   * Gets or sets the base URL to use to load assets\n   */\n  static get BaseUrl() {\n    return FileToolsOptions.BaseUrl;\n  }\n  static set BaseUrl(value) {\n    FileToolsOptions.BaseUrl = value;\n  }\n  /**\n   * This function checks whether a URL is absolute or not.\n   * It will also detect data and blob URLs\n   * @param url the url to check\n   * @returns is the url absolute or relative\n   */\n  static IsAbsoluteUrl(url) {\n    // See https://stackoverflow.com/a/38979205.\n    // URL is protocol-relative (= absolute)\n    if (url.indexOf(\"//\") === 0) {\n      return true;\n    }\n    // URL has no protocol (= relative)\n    if (url.indexOf(\"://\") === -1) {\n      return false;\n    }\n    // URL does not contain a dot, i.e. no TLD (= relative, possibly REST)\n    if (url.indexOf(\".\") === -1) {\n      return false;\n    }\n    // URL does not contain a single slash (= relative)\n    if (url.indexOf(\"/\") === -1) {\n      return false;\n    }\n    // The first colon comes after the first slash (= relative)\n    if (url.indexOf(\":\") > url.indexOf(\"/\")) {\n      return false;\n    }\n    // Protocol is defined before first dot (= absolute)\n    if (url.indexOf(\"://\") < url.indexOf(\".\")) {\n      return true;\n    }\n    if (url.indexOf(\"data:\") === 0 || url.indexOf(\"blob:\") === 0) {\n      return true;\n    }\n    // Anything else must be relative\n    return false;\n  }\n  /**\n   * Sets the base URL to use to load scripts\n   */\n  static set ScriptBaseUrl(value) {\n    FileToolsOptions.ScriptBaseUrl = value;\n  }\n  static get ScriptBaseUrl() {\n    return FileToolsOptions.ScriptBaseUrl;\n  }\n  /**\n   * Sets a preprocessing function to run on a source URL before importing it\n   * Note that this function will execute AFTER the base URL is appended to the URL\n   */\n  static set ScriptPreprocessUrl(func) {\n    FileToolsOptions.ScriptPreprocessUrl = func;\n  }\n  static get ScriptPreprocessUrl() {\n    return FileToolsOptions.ScriptPreprocessUrl;\n  }\n  /**\n   * Gets or sets the retry strategy to apply when an error happens while loading an asset\n   */\n  static get DefaultRetryStrategy() {\n    return FileToolsOptions.DefaultRetryStrategy;\n  }\n  static set DefaultRetryStrategy(strategy) {\n    FileToolsOptions.DefaultRetryStrategy = strategy;\n  }\n  /**\n   * Default behavior for cors in the application.\n   * It can be a string if the expected behavior is identical in the entire app.\n   * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\n   */\n  static get CorsBehavior() {\n    return FileToolsOptions.CorsBehavior;\n  }\n  static set CorsBehavior(value) {\n    FileToolsOptions.CorsBehavior = value;\n  }\n  /**\n   * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\n   * @ignorenaming\n   */\n  static get UseFallbackTexture() {\n    return EngineStore.UseFallbackTexture;\n  }\n  static set UseFallbackTexture(value) {\n    EngineStore.UseFallbackTexture = value;\n  }\n  /**\n   * Use this object to register external classes like custom textures or material\n   * to allow the loaders to instantiate them\n   */\n  static get RegisteredExternalClasses() {\n    return InstantiationTools.RegisteredExternalClasses;\n  }\n  static set RegisteredExternalClasses(classes) {\n    InstantiationTools.RegisteredExternalClasses = classes;\n  }\n  /**\n   * Texture content used if a texture cannot loaded\n   * @ignorenaming\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  static get fallbackTexture() {\n    return EngineStore.FallbackTexture;\n  }\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  static set fallbackTexture(value) {\n    EngineStore.FallbackTexture = value;\n  }\n  /**\n   * Read the content of a byte array at a specified coordinates (taking in account wrapping)\n   * @param u defines the coordinate on X axis\n   * @param v defines the coordinate on Y axis\n   * @param width defines the width of the source data\n   * @param height defines the height of the source data\n   * @param pixels defines the source byte array\n   * @param color defines the output color\n   */\n  static FetchToRef(u, v, width, height, pixels, color) {\n    const wrappedU = Math.abs(u) * width % width | 0;\n    const wrappedV = Math.abs(v) * height % height | 0;\n    const position = (wrappedU + wrappedV * width) * 4;\n    color.r = pixels[position] / 255;\n    color.g = pixels[position + 1] / 255;\n    color.b = pixels[position + 2] / 255;\n    color.a = pixels[position + 3] / 255;\n  }\n  /**\n   * Interpolates between a and b via alpha\n   * @param a The lower value (returned when alpha = 0)\n   * @param b The upper value (returned when alpha = 1)\n   * @param alpha The interpolation-factor\n   * @returns The mixed value\n   */\n  static Mix(a, b, alpha) {\n    return a * (1 - alpha) + b * alpha;\n  }\n  /**\n   * Tries to instantiate a new object from a given class name\n   * @param className defines the class name to instantiate\n   * @returns the new object or null if the system was not able to do the instantiation\n   */\n  static Instantiate(className) {\n    return InstantiationTools.Instantiate(className);\n  }\n  /**\n   * Polyfill for setImmediate\n   * @param action defines the action to execute after the current execution block\n   */\n  static SetImmediate(action) {\n    TimingTools.SetImmediate(action);\n  }\n  /**\n   * Function indicating if a number is an exponent of 2\n   * @param value defines the value to test\n   * @returns true if the value is an exponent of 2\n   */\n  static IsExponentOfTwo(value) {\n    let count = 1;\n    do {\n      count *= 2;\n    } while (count < value);\n    return count === value;\n  }\n  /**\n   * Returns the nearest 32-bit single precision float representation of a Number\n   * @param value A Number.  If the parameter is of a different type, it will get converted\n   * to a number or to NaN if it cannot be converted\n   * @returns number\n   */\n  static FloatRound(value) {\n    return Math.fround(value);\n  }\n  /**\n   * Extracts the filename from a path\n   * @param path defines the path to use\n   * @returns the filename\n   */\n  static GetFilename(path) {\n    const index = path.lastIndexOf(\"/\");\n    if (index < 0) {\n      return path;\n    }\n    return path.substring(index + 1);\n  }\n  /**\n   * Extracts the \"folder\" part of a path (everything before the filename).\n   * @param uri The URI to extract the info from\n   * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\n   * @returns The \"folder\" part of the path\n   */\n  static GetFolderPath(uri, returnUnchangedIfNoSlash = false) {\n    const index = uri.lastIndexOf(\"/\");\n    if (index < 0) {\n      if (returnUnchangedIfNoSlash) {\n        return uri;\n      }\n      return \"\";\n    }\n    return uri.substring(0, index + 1);\n  }\n  /**\n   * Convert an angle in radians to degrees\n   * @param angle defines the angle to convert\n   * @returns the angle in degrees\n   */\n  static ToDegrees(angle) {\n    return angle * 180 / Math.PI;\n  }\n  /**\n   * Convert an angle in degrees to radians\n   * @param angle defines the angle to convert\n   * @returns the angle in radians\n   */\n  static ToRadians(angle) {\n    return angle * Math.PI / 180;\n  }\n  /**\n   * Smooth angle changes (kind of low-pass filter), in particular for device orientation \"shaking\"\n   * Use trigonometric functions to avoid discontinuity (0/360, -180/180)\n   * @param previousAngle defines last angle value, in degrees\n   * @param newAngle defines new angle value, in degrees\n   * @param smoothFactor defines smoothing sensitivity; min 0: no smoothing, max 1: new data ignored\n   * @returns the angle in degrees\n   */\n  static SmoothAngleChange(previousAngle, newAngle, smoothFactor = 0.9) {\n    const previousAngleRad = this.ToRadians(previousAngle);\n    const newAngleRad = this.ToRadians(newAngle);\n    return this.ToDegrees(Math.atan2((1 - smoothFactor) * Math.sin(newAngleRad) + smoothFactor * Math.sin(previousAngleRad), (1 - smoothFactor) * Math.cos(newAngleRad) + smoothFactor * Math.cos(previousAngleRad)));\n  }\n  /**\n   * Returns an array if obj is not an array\n   * @param obj defines the object to evaluate as an array\n   * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\n   * @returns either obj directly if obj is an array or a new array containing obj\n   */\n  static MakeArray(obj, allowsNullUndefined) {\n    if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\n      return null;\n    }\n    return Array.isArray(obj) ? obj : [obj];\n  }\n  /**\n   * Gets the pointer prefix to use\n   * @param engine defines the engine we are finding the prefix for\n   * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\n   */\n  static GetPointerPrefix(engine) {\n    let eventPrefix = \"pointer\";\n    // Check if pointer events are supported\n    if (IsWindowObjectExist() && !window.PointerEvent) {\n      eventPrefix = \"mouse\";\n    }\n    // Special Fallback MacOS Safari...\n    if (engine._badDesktopOS && !engine._badOS &&\n    // And not ipad pros who claim to be macs...\n    !(document && \"ontouchend\" in document)) {\n      eventPrefix = \"mouse\";\n    }\n    return eventPrefix;\n  }\n  /**\n   * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\n   * @param url define the url we are trying\n   * @param element define the dom element where to configure the cors policy\n   * @param element.crossOrigin\n   */\n  static SetCorsBehavior(url, element) {\n    SetCorsBehavior(url, element);\n  }\n  /**\n   * Sets the referrerPolicy behavior on a dom element.\n   * @param referrerPolicy define the referrer policy to use\n   * @param element define the dom element where to configure the referrer policy\n   * @param element.referrerPolicy\n   */\n  static SetReferrerPolicyBehavior(referrerPolicy, element) {\n    element.referrerPolicy = referrerPolicy;\n  }\n  // External files\n  /**\n   * Removes unwanted characters from an url\n   * @param url defines the url to clean\n   * @returns the cleaned url\n   */\n  static CleanUrl(url) {\n    url = url.replace(/#/gm, \"%23\");\n    return url;\n  }\n  /**\n   * Gets or sets a function used to pre-process url before using them to load assets\n   */\n  static get PreprocessUrl() {\n    return FileToolsOptions.PreprocessUrl;\n  }\n  static set PreprocessUrl(processor) {\n    FileToolsOptions.PreprocessUrl = processor;\n  }\n  /**\n   * Loads an image as an HTMLImageElement.\n   * @param input url string, ArrayBuffer, or Blob to load\n   * @param onLoad callback called when the image successfully loads\n   * @param onError callback called when the image fails to load\n   * @param offlineProvider offline provider for caching\n   * @param mimeType optional mime type\n   * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\n   * @returns the HTMLImageElement of the loaded image\n   */\n  static LoadImage(input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions) {\n    return FileToolLoadImage(input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions);\n  }\n  /**\n   * Loads a file from a url\n   * @param url url string, ArrayBuffer, or Blob to load\n   * @param onSuccess callback called when the file successfully loads\n   * @param onProgress callback called while file is loading (if the server supports this mode)\n   * @param offlineProvider defines the offline provider for caching\n   * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\n   * @param onError callback called when the file fails to load\n   * @returns a file request object\n   */\n  static LoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError) {\n    return FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\n  }\n  /**\n   * Loads a file from a url\n   * @param url the file url to load\n   * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\n   * @returns a promise containing an ArrayBuffer corresponding to the loaded file\n   */\n  static LoadFileAsync(url, useArrayBuffer = true) {\n    return new Promise((resolve, reject) => {\n      FileToolsLoadFile(url, data => {\n        resolve(data);\n      }, undefined, undefined, useArrayBuffer, (request, exception) => {\n        reject(exception);\n      });\n    });\n  }\n  /**\n   * Get a script URL including preprocessing\n   * @param scriptUrl the script Url to process\n   * @returns a modified URL to use\n   */\n  static GetBabylonScriptURL(scriptUrl, forceAbsoluteUrl) {\n    if (!scriptUrl) {\n      return \"\";\n    }\n    // check if the URL is absolute or relative. Otherwise, append the base URL\n    if (!Tools.IsAbsoluteUrl(scriptUrl)) {\n      const baseUrl = Tools.ScriptBaseUrl[Tools.ScriptBaseUrl.length - 1] === \"/\" ? Tools.ScriptBaseUrl : Tools.ScriptBaseUrl + \"/\";\n      scriptUrl = baseUrl + (scriptUrl[0] === \"/\" ? scriptUrl.substring(1) : scriptUrl);\n    }\n    // run the preprocessor\n    scriptUrl = Tools.ScriptPreprocessUrl(scriptUrl);\n    if (forceAbsoluteUrl) {\n      scriptUrl = Tools.GetAbsoluteUrl(scriptUrl);\n    }\n    return scriptUrl;\n  }\n  /**\n   * This function is used internally by babylon components to load a script (identified by an url). When the url returns, the\n   * content of this file is added into a new script element, attached to the DOM (body element)\n   * @param scriptUrl defines the url of the script to load\n   * @param onSuccess defines the callback called when the script is loaded\n   * @param onError defines the callback to call if an error occurs\n   * @param scriptId defines the id of the script element\n   */\n  static LoadBabylonScript(scriptUrl, onSuccess, onError, scriptId) {\n    scriptUrl = Tools.GetBabylonScriptURL(scriptUrl);\n    Tools.LoadScript(scriptUrl, onSuccess, onError);\n  }\n  /**\n   * Load an asynchronous script (identified by an url). When the url returns, the\n   * content of this file is added into a new script element, attached to the DOM (body element)\n   * @param scriptUrl defines the url of the script to laod\n   * @returns a promise request object\n   */\n  static LoadBabylonScriptAsync(scriptUrl) {\n    scriptUrl = Tools.GetBabylonScriptURL(scriptUrl);\n    return Tools.LoadScriptAsync(scriptUrl);\n  }\n  /**\n   * This function is used internally by babylon components to load a script (identified by an url). When the url returns, the\n   * content of this file is added into a new script element, attached to the DOM (body element)\n   * @param scriptUrl defines the url of the script to load\n   * @param onSuccess defines the callback called when the script is loaded\n   * @param onError defines the callback to call if an error occurs\n   * @param scriptId defines the id of the script element\n   */\n  static LoadScript(scriptUrl, onSuccess, onError, scriptId) {\n    if (typeof importScripts === \"function\") {\n      try {\n        importScripts(scriptUrl);\n        onSuccess();\n      } catch (e) {\n        onError === null || onError === void 0 ? void 0 : onError(`Unable to load script '${scriptUrl}' in worker`, e);\n      }\n      return;\n    } else if (!IsWindowObjectExist()) {\n      onError === null || onError === void 0 ? void 0 : onError(`Cannot load script '${scriptUrl}' outside of a window or a worker`);\n      return;\n    }\n    const head = document.getElementsByTagName(\"head\")[0];\n    const script = document.createElement(\"script\");\n    script.setAttribute(\"type\", \"text/javascript\");\n    script.setAttribute(\"src\", scriptUrl);\n    if (scriptId) {\n      script.id = scriptId;\n    }\n    script.onload = () => {\n      if (onSuccess) {\n        onSuccess();\n      }\n    };\n    script.onerror = e => {\n      if (onError) {\n        onError(`Unable to load script '${scriptUrl}'`, e);\n      }\n    };\n    head.appendChild(script);\n  }\n  /**\n   * Load an asynchronous script (identified by an url). When the url returns, the\n   * content of this file is added into a new script element, attached to the DOM (body element)\n   * @param scriptUrl defines the url of the script to laod\n   * @returns a promise request object\n   */\n  static LoadScriptAsync(scriptUrl) {\n    return new Promise((resolve, reject) => {\n      this.LoadScript(scriptUrl, () => {\n        resolve();\n      }, (message, exception) => {\n        reject(exception || new Error(message));\n      });\n    });\n  }\n  /**\n   * Loads a file from a blob\n   * @param fileToLoad defines the blob to use\n   * @param callback defines the callback to call when data is loaded\n   * @param progressCallback defines the callback to call during loading process\n   * @returns a file request object\n   */\n  static ReadFileAsDataURL(fileToLoad, callback, progressCallback) {\n    const reader = new FileReader();\n    const request = {\n      onCompleteObservable: new Observable(),\n      abort: () => reader.abort()\n    };\n    reader.onloadend = () => {\n      request.onCompleteObservable.notifyObservers(request);\n    };\n    reader.onload = e => {\n      //target doesn't have result from ts 1.3\n      callback(e.target[\"result\"]);\n    };\n    reader.onprogress = progressCallback;\n    reader.readAsDataURL(fileToLoad);\n    return request;\n  }\n  /**\n   * Reads a file from a File object\n   * @param file defines the file to load\n   * @param onSuccess defines the callback to call when data is loaded\n   * @param onProgress defines the callback to call during loading process\n   * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\n   * @param onError defines the callback to call when an error occurs\n   * @returns a file request object\n   */\n  static ReadFile(file, onSuccess, onProgress, useArrayBuffer, onError) {\n    return FileToolsReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\n  }\n  /**\n   * Creates a data url from a given string content\n   * @param content defines the content to convert\n   * @returns the new data url link\n   */\n  static FileAsURL(content) {\n    const fileBlob = new Blob([content]);\n    const url = window.URL;\n    const link = url.createObjectURL(fileBlob);\n    return link;\n  }\n  /**\n   * Format the given number to a specific decimal format\n   * @param value defines the number to format\n   * @param decimals defines the number of decimals to use\n   * @returns the formatted string\n   */\n  static Format(value, decimals = 2) {\n    return value.toFixed(decimals);\n  }\n  /**\n   * Tries to copy an object by duplicating every property\n   * @param source defines the source object\n   * @param destination defines the target object\n   * @param doNotCopyList defines a list of properties to avoid\n   * @param mustCopyList defines a list of properties to copy (even if they start with _)\n   */\n  static DeepCopy(source, destination, doNotCopyList, mustCopyList) {\n    DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\n  }\n  /**\n   * Gets a boolean indicating if the given object has no own property\n   * @param obj defines the object to test\n   * @returns true if object has no own property\n   */\n  static IsEmpty(obj) {\n    for (const i in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, i)) {\n        return false;\n      }\n    }\n    return true;\n  }\n  /**\n   * Function used to register events at window level\n   * @param windowElement defines the Window object to use\n   * @param events defines the events to register\n   */\n  static RegisterTopRootEvents(windowElement, events) {\n    for (let index = 0; index < events.length; index++) {\n      const event = events[index];\n      windowElement.addEventListener(event.name, event.handler, false);\n      try {\n        if (window.parent) {\n          window.parent.addEventListener(event.name, event.handler, false);\n        }\n      } catch (e) {\n        // Silently fails...\n      }\n    }\n  }\n  /**\n   * Function used to unregister events from window level\n   * @param windowElement defines the Window object to use\n   * @param events defines the events to unregister\n   */\n  static UnregisterTopRootEvents(windowElement, events) {\n    for (let index = 0; index < events.length; index++) {\n      const event = events[index];\n      windowElement.removeEventListener(event.name, event.handler);\n      try {\n        if (windowElement.parent) {\n          windowElement.parent.removeEventListener(event.name, event.handler);\n        }\n      } catch (e) {\n        // Silently fails...\n      }\n    }\n  }\n  /**\n   * Dumps the current bound framebuffer\n   * @param width defines the rendering width\n   * @param height defines the rendering height\n   * @param engine defines the hosting engine\n   * @param successCallback defines the callback triggered once the data are available\n   * @param mimeType defines the mime type of the result\n   * @param fileName defines the filename to download. If present, the result will automatically be downloaded\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   * @returns a void promise\n   */\n  static async DumpFramebuffer(width, height, engine, successCallback, mimeType = \"image/png\", fileName, quality) {\n    throw _WarnImport(\"DumpTools\");\n  }\n  /**\n   * Dumps an array buffer\n   * @param width defines the rendering width\n   * @param height defines the rendering height\n   * @param data the data array\n   * @param successCallback defines the callback triggered once the data are available\n   * @param mimeType defines the mime type of the result\n   * @param fileName defines the filename to download. If present, the result will automatically be downloaded\n   * @param invertY true to invert the picture in the Y dimension\n   * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   */\n  static DumpData(width, height, data, successCallback, mimeType = \"image/png\", fileName, invertY = false, toArrayBuffer = false, quality) {\n    throw _WarnImport(\"DumpTools\");\n  }\n  /**\n   * Dumps an array buffer\n   * @param width defines the rendering width\n   * @param height defines the rendering height\n   * @param data the data array\n   * @param mimeType defines the mime type of the result\n   * @param fileName defines the filename to download. If present, the result will automatically be downloaded\n   * @param invertY true to invert the picture in the Y dimension\n   * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   * @returns a promise that resolve to the final data\n   */\n  static DumpDataAsync(width, height, data, mimeType = \"image/png\", fileName, invertY = false, toArrayBuffer = false, quality) {\n    throw _WarnImport(\"DumpTools\");\n  }\n  static _IsOffScreenCanvas(canvas) {\n    return canvas.convertToBlob !== undefined;\n  }\n  /**\n   * Converts the canvas data to blob.\n   * This acts as a polyfill for browsers not supporting the to blob function.\n   * @param canvas Defines the canvas to extract the data from (can be an offscreen canvas)\n   * @param successCallback Defines the callback triggered once the data are available\n   * @param mimeType Defines the mime type of the result\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   */\n  static ToBlob(canvas, successCallback, mimeType = \"image/png\", quality) {\n    // We need HTMLCanvasElement.toBlob for HD screenshots\n    if (!Tools._IsOffScreenCanvas(canvas) && !canvas.toBlob) {\n      //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\n      canvas.toBlob = function (callback, type, quality) {\n        setTimeout(() => {\n          const binStr = atob(this.toDataURL(type, quality).split(\",\")[1]),\n            len = binStr.length,\n            arr = new Uint8Array(len);\n          for (let i = 0; i < len; i++) {\n            arr[i] = binStr.charCodeAt(i);\n          }\n          callback(new Blob([arr]));\n        });\n      };\n    }\n    if (Tools._IsOffScreenCanvas(canvas)) {\n      canvas.convertToBlob({\n        type: mimeType,\n        quality\n      }).then(blob => successCallback(blob));\n    } else {\n      canvas.toBlob(function (blob) {\n        successCallback(blob);\n      }, mimeType, quality);\n    }\n  }\n  /**\n   * Download a Blob object\n   * @param blob the Blob object\n   * @param fileName the file name to download\n   * @returns\n   */\n  static DownloadBlob(blob, fileName) {\n    //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\n    if (\"download\" in document.createElement(\"a\")) {\n      if (!fileName) {\n        const date = new Date();\n        const stringDate = (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) + \"-\" + date.getDate() + \"_\" + date.getHours() + \"-\" + (\"0\" + date.getMinutes()).slice(-2);\n        fileName = \"screenshot_\" + stringDate + \".png\";\n      }\n      Tools.Download(blob, fileName);\n    } else {\n      if (blob && typeof URL !== \"undefined\") {\n        const url = URL.createObjectURL(blob);\n        const newWindow = window.open(\"\");\n        if (!newWindow) {\n          return;\n        }\n        const img = newWindow.document.createElement(\"img\");\n        img.onload = function () {\n          // no longer need to read the blob so it's revoked\n          URL.revokeObjectURL(url);\n        };\n        img.src = url;\n        newWindow.document.body.appendChild(img);\n      }\n    }\n  }\n  /**\n   * Encodes the canvas data to base 64, or automatically downloads the result if `fileName` is defined.\n   * @param canvas The canvas to get the data from, which can be an offscreen canvas.\n   * @param successCallback The callback which is triggered once the data is available. If `fileName` is defined, the callback will be invoked after the download occurs, and the `data` argument will be an empty string.\n   * @param mimeType The mime type of the result.\n   * @param fileName The name of the file to download. If defined, the result will automatically be downloaded. If not defined, and `successCallback` is also not defined, the result will automatically be downloaded with an auto-generated file name.\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   */\n  static EncodeScreenshotCanvasData(canvas, successCallback, mimeType = \"image/png\", fileName, quality) {\n    if (typeof fileName === \"string\" || !successCallback) {\n      this.ToBlob(canvas, function (blob) {\n        if (blob) {\n          Tools.DownloadBlob(blob, fileName);\n        }\n        if (successCallback) {\n          successCallback(\"\");\n        }\n      }, mimeType, quality);\n    } else if (successCallback) {\n      if (Tools._IsOffScreenCanvas(canvas)) {\n        canvas.convertToBlob({\n          type: mimeType,\n          quality\n        }).then(blob => {\n          const reader = new FileReader();\n          reader.readAsDataURL(blob);\n          reader.onloadend = () => {\n            const base64data = reader.result;\n            successCallback(base64data);\n          };\n        });\n        return;\n      }\n      const base64Image = canvas.toDataURL(mimeType, quality);\n      successCallback(base64Image);\n    }\n  }\n  /**\n   * Downloads a blob in the browser\n   * @param blob defines the blob to download\n   * @param fileName defines the name of the downloaded file\n   */\n  static Download(blob, fileName) {\n    if (typeof URL === \"undefined\") {\n      return;\n    }\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    a.style.display = \"none\";\n    a.href = url;\n    a.download = fileName;\n    a.addEventListener(\"click\", () => {\n      if (a.parentElement) {\n        a.parentElement.removeChild(a);\n      }\n    });\n    a.click();\n    window.URL.revokeObjectURL(url);\n  }\n  /**\n   * Will return the right value of the noPreventDefault variable\n   * Needed to keep backwards compatibility to the old API.\n   *\n   * @param args arguments passed to the attachControl function\n   * @returns the correct value for noPreventDefault\n   */\n  static BackCompatCameraNoPreventDefault(args) {\n    // is it used correctly?\n    if (typeof args[0] === \"boolean\") {\n      return args[0];\n    } else if (typeof args[1] === \"boolean\") {\n      return args[1];\n    }\n    return false;\n  }\n  /**\n   * Captures a screenshot of the current rendering\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\n   * @param engine defines the rendering engine\n   * @param camera defines the source camera\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param successCallback defines the callback receives a single parameter which contains the\n   * screenshot as a string of base64-encoded characters. This string can be assigned to the\n   * src parameter of an <img> to display it\n   * @param mimeType defines the MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   * @param forceDownload force the system to download the image even if a successCallback is provided\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static CreateScreenshot(engine, camera, size, successCallback, mimeType = \"image/png\", forceDownload = false, quality) {\n    throw _WarnImport(\"ScreenshotTools\");\n  }\n  /**\n   * Captures a screenshot of the current rendering\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\n   * @param engine defines the rendering engine\n   * @param camera defines the source camera\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param mimeType defines the MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   * @returns screenshot as a string of base64-encoded characters. This string can be assigned\n   * to the src parameter of an <img> to display it\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static CreateScreenshotAsync(engine, camera, size, mimeType = \"image/png\", quality) {\n    throw _WarnImport(\"ScreenshotTools\");\n  }\n  /**\n   * Generates an image screenshot from the specified camera.\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\n   * @param engine The engine to use for rendering\n   * @param camera The camera to use for rendering\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param successCallback The callback receives a single parameter which contains the\n   * screenshot as a string of base64-encoded characters. This string can be assigned to the\n   * src parameter of an <img> to display it\n   * @param mimeType The MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   * @param samples Texture samples (default: 1)\n   * @param antialiasing Whether antialiasing should be turned on or not (default: false)\n   * @param fileName A name for for the downloaded file.\n   * @param renderSprites Whether the sprites should be rendered or not (default: false)\n   * @param enableStencilBuffer Whether the stencil buffer should be enabled or not (default: false)\n   * @param useLayerMask if the camera's layer mask should be used to filter what should be rendered (default: true)\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static CreateScreenshotUsingRenderTarget(engine, camera, size, successCallback, mimeType = \"image/png\", samples = 1, antialiasing = false, fileName, renderSprites = false, enableStencilBuffer = false, useLayerMask = true, quality) {\n    throw _WarnImport(\"ScreenshotTools\");\n  }\n  /**\n   * Generates an image screenshot from the specified camera.\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\n   * @param engine The engine to use for rendering\n   * @param camera The camera to use for rendering\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param mimeType The MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   * @param samples Texture samples (default: 1)\n   * @param antialiasing Whether antialiasing should be turned on or not (default: false)\n   * @param fileName A name for for the downloaded file.\n   * @returns screenshot as a string of base64-encoded characters. This string can be assigned\n   * @param renderSprites Whether the sprites should be rendered or not (default: false)\n   * @param enableStencilBuffer Whether the stencil buffer should be enabled or not (default: false)\n   * @param useLayerMask if the camera's layer mask should be used to filter what should be rendered (default: true)\n   * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\n   * to the src parameter of an <img> to display it\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static CreateScreenshotUsingRenderTargetAsync(engine, camera, size, mimeType = \"image/png\", samples = 1, antialiasing = false, fileName, renderSprites = false, enableStencilBuffer = false, useLayerMask = true, quality) {\n    throw _WarnImport(\"ScreenshotTools\");\n  }\n  /**\n   * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\n   * Be aware Math.random() could cause collisions, but:\n   * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\n   * @returns a pseudo random id\n   */\n  static RandomId() {\n    return RandomGUID();\n  }\n  /**\n   * Test if the given uri is a base64 string\n   * @deprecated Please use FileTools.IsBase64DataUrl instead.\n   * @param uri The uri to test\n   * @returns True if the uri is a base64 string or false otherwise\n   */\n  static IsBase64(uri) {\n    return IsBase64DataUrl(uri);\n  }\n  /**\n   * Decode the given base64 uri.\n   * @deprecated Please use FileTools.DecodeBase64UrlToBinary instead.\n   * @param uri The uri to decode\n   * @returns The decoded base64 data.\n   */\n  static DecodeBase64(uri) {\n    return DecodeBase64UrlToBinary(uri);\n  }\n  /**\n   * Gets a value indicating the number of loading errors\n   * @ignorenaming\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  static get errorsCount() {\n    return Logger.errorsCount;\n  }\n  /**\n   * Log a message to the console\n   * @param message defines the message to log\n   */\n  static Log(message) {\n    Logger.Log(message);\n  }\n  /**\n   * Write a warning message to the console\n   * @param message defines the message to log\n   */\n  static Warn(message) {\n    Logger.Warn(message);\n  }\n  /**\n   * Write an error message to the console\n   * @param message defines the message to log\n   */\n  static Error(message) {\n    Logger.Error(message);\n  }\n  /**\n   * Gets current log cache (list of logs)\n   */\n  static get LogCache() {\n    return Logger.LogCache;\n  }\n  /**\n   * Clears the log cache\n   */\n  static ClearLogCache() {\n    Logger.ClearLogCache();\n  }\n  /**\n   * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\n   */\n  static set LogLevels(level) {\n    Logger.LogLevels = level;\n  }\n  /**\n   * Sets the current performance log level\n   */\n  static set PerformanceLogLevel(level) {\n    if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\n      Tools.StartPerformanceCounter = Tools._StartUserMark;\n      Tools.EndPerformanceCounter = Tools._EndUserMark;\n      return;\n    }\n    if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\n      Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\n      Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\n      return;\n    }\n    Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\n    Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static _StartPerformanceCounterDisabled(counterName, condition) {}\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static _EndPerformanceCounterDisabled(counterName, condition) {}\n  static _StartUserMark(counterName, condition = true) {\n    if (!Tools._Performance) {\n      if (!IsWindowObjectExist()) {\n        return;\n      }\n      Tools._Performance = window.performance;\n    }\n    if (!condition || !Tools._Performance.mark) {\n      return;\n    }\n    Tools._Performance.mark(counterName + \"-Begin\");\n  }\n  static _EndUserMark(counterName, condition = true) {\n    if (!condition || !Tools._Performance.mark) {\n      return;\n    }\n    Tools._Performance.mark(counterName + \"-End\");\n    Tools._Performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\n  }\n  static _StartPerformanceConsole(counterName, condition = true) {\n    if (!condition) {\n      return;\n    }\n    Tools._StartUserMark(counterName, condition);\n    if (console.time) {\n      console.time(counterName);\n    }\n  }\n  static _EndPerformanceConsole(counterName, condition = true) {\n    if (!condition) {\n      return;\n    }\n    Tools._EndUserMark(counterName, condition);\n    console.timeEnd(counterName);\n  }\n  /**\n   * Gets either window.performance.now() if supported or Date.now() else\n   */\n  static get Now() {\n    return PrecisionDate.Now;\n  }\n  /**\n   * This method will return the name of the class used to create the instance of the given object.\n   * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\n   * @param object the object to get the class name from\n   * @param isType defines if the object is actually a type\n   * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\n   */\n  static GetClassName(object, isType = false) {\n    let name = null;\n    if (!isType && object.getClassName) {\n      name = object.getClassName();\n    } else {\n      if (object instanceof Object) {\n        const classObj = isType ? object : Object.getPrototypeOf(object);\n        name = classObj.constructor[\"__bjsclassName__\"];\n      }\n      if (!name) {\n        name = typeof object;\n      }\n    }\n    return name;\n  }\n  /**\n   * Gets the first element of an array satisfying a given predicate\n   * @param array defines the array to browse\n   * @param predicate defines the predicate to use\n   * @returns null if not found or the element\n   */\n  static First(array, predicate) {\n    for (const el of array) {\n      if (predicate(el)) {\n        return el;\n      }\n    }\n    return null;\n  }\n  /**\n   * This method will return the name of the full name of the class, including its owning module (if any).\n   * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\n   * @param object the object to get the class name from\n   * @param isType defines if the object is actually a type\n   * @returns a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\n   * @ignorenaming\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  static getFullClassName(object, isType = false) {\n    let className = null;\n    let moduleName = null;\n    if (!isType && object.getClassName) {\n      className = object.getClassName();\n    } else {\n      if (object instanceof Object) {\n        const classObj = isType ? object : Object.getPrototypeOf(object);\n        className = classObj.constructor[\"__bjsclassName__\"];\n        moduleName = classObj.constructor[\"__bjsmoduleName__\"];\n      }\n      if (!className) {\n        className = typeof object;\n      }\n    }\n    if (!className) {\n      return null;\n    }\n    return (moduleName != null ? moduleName + \".\" : \"\") + className;\n  }\n  /**\n   * Returns a promise that resolves after the given amount of time.\n   * @param delay Number of milliseconds to delay\n   * @returns Promise that resolves after the given amount of time\n   */\n  static DelayAsync(delay) {\n    return new Promise(resolve => {\n      setTimeout(() => {\n        resolve();\n      }, delay);\n    });\n  }\n  /**\n   * Utility function to detect if the current user agent is Safari\n   * @returns whether or not the current user agent is safari\n   */\n  static IsSafari() {\n    if (!IsNavigatorAvailable()) {\n      return false;\n    }\n    return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n  }\n}\n/**\n * Enable/Disable Custom HTTP Request Headers globally.\n * default = false\n * @see CustomRequestHeaders\n */\nTools.UseCustomRequestHeaders = false;\n/**\n * Custom HTTP Request Headers to be sent with XMLHttpRequests\n * i.e. when loading files, where the server/service expects an Authorization header\n */\nTools.CustomRequestHeaders = WebRequest.CustomRequestHeaders;\n/**\n * Extracts text content from a DOM element hierarchy\n * Back Compat only, please use GetDOMTextContent instead.\n */\nTools.GetDOMTextContent = GetDOMTextContent;\nTools.GetAbsoluteUrl = typeof document === \"object\" ? url => {\n  const a = document.createElement(\"a\");\n  a.href = url;\n  return a.href;\n} : typeof URL === \"function\" && typeof location === \"object\" ? url => new URL(url, location.origin).href : () => {\n  throw new Error(\"Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.\");\n};\n// Logs\n/**\n * No log\n */\nTools.NoneLogLevel = Logger.NoneLogLevel;\n/**\n * Only message logs\n */\nTools.MessageLogLevel = Logger.MessageLogLevel;\n/**\n * Only warning logs\n */\nTools.WarningLogLevel = Logger.WarningLogLevel;\n/**\n * Only error logs\n */\nTools.ErrorLogLevel = Logger.ErrorLogLevel;\n/**\n * All logs\n */\nTools.AllLogLevel = Logger.AllLogLevel;\n/**\n * Checks if the window object exists\n * Back Compat only, please use IsWindowObjectExist instead.\n */\nTools.IsWindowObjectExist = IsWindowObjectExist;\n// Performances\n/**\n * No performance log\n */\nTools.PerformanceNoneLogLevel = 0;\n/**\n * Use user marks to log performance\n */\nTools.PerformanceUserMarkLogLevel = 1;\n/**\n * Log performance to the console\n */\nTools.PerformanceConsoleLogLevel = 2;\n/**\n * Starts a performance counter\n */\nTools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\n/**\n * Ends a specific performance counter\n */\nTools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\n/**\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\n * @param name The name of the class, case should be preserved\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\n */\nexport function className(name, module) {\n  return target => {\n    target[\"__bjsclassName__\"] = name;\n    target[\"__bjsmoduleName__\"] = module != null ? module : null;\n  };\n}\n/**\n * An implementation of a loop for asynchronous functions.\n */\nexport class AsyncLoop {\n  /**\n   * Constructor.\n   * @param iterations the number of iterations.\n   * @param func the function to run each iteration\n   * @param successCallback the callback that will be called upon successful execution\n   * @param offset starting offset.\n   */\n  constructor(\n  /**\n   * Defines the number of iterations for the loop\n   */\n  iterations, func, successCallback, offset = 0) {\n    this.iterations = iterations;\n    this.index = offset - 1;\n    this._done = false;\n    this._fn = func;\n    this._successCallback = successCallback;\n  }\n  /**\n   * Execute the next iteration. Must be called after the last iteration was finished.\n   */\n  executeNext() {\n    if (!this._done) {\n      if (this.index + 1 < this.iterations) {\n        ++this.index;\n        this._fn(this);\n      } else {\n        this.breakLoop();\n      }\n    }\n  }\n  /**\n   * Break the loop and run the success callback.\n   */\n  breakLoop() {\n    this._done = true;\n    this._successCallback();\n  }\n  /**\n   * Create and run an async loop.\n   * @param iterations the number of iterations.\n   * @param fn the function to run each iteration\n   * @param successCallback the callback that will be called upon successful execution\n   * @param offset starting offset.\n   * @returns the created async loop object\n   */\n  static Run(iterations, fn, successCallback, offset = 0) {\n    const loop = new AsyncLoop(iterations, fn, successCallback, offset);\n    loop.executeNext();\n    return loop;\n  }\n  /**\n   * A for-loop that will run a given number of iterations synchronous and the rest async.\n   * @param iterations total number of iterations\n   * @param syncedIterations number of synchronous iterations in each async iteration.\n   * @param fn the function to call each iteration.\n   * @param callback a success call back that will be called when iterating stops.\n   * @param breakFunction a break condition (optional)\n   * @param timeout timeout settings for the setTimeout function. default - 0.\n   * @returns the created async loop object\n   */\n  static SyncAsyncForLoop(iterations, syncedIterations, fn, callback, breakFunction, timeout = 0) {\n    return AsyncLoop.Run(Math.ceil(iterations / syncedIterations), loop => {\n      if (breakFunction && breakFunction()) {\n        loop.breakLoop();\n      } else {\n        setTimeout(() => {\n          for (let i = 0; i < syncedIterations; ++i) {\n            const iteration = loop.index * syncedIterations + i;\n            if (iteration >= iterations) {\n              break;\n            }\n            fn(iteration);\n            if (breakFunction && breakFunction()) {\n              loop.breakLoop();\n              break;\n            }\n          }\n          loop.executeNext();\n        }, timeout);\n      }\n    }, callback);\n  }\n}\n// Will only be define if Tools is imported freeing up some space when only engine is required\nEngineStore.FallbackTexture = \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\";","map":{"version":3,"names":["Observable","GetDOMTextContent","IsNavigatorAvailable","IsWindowObjectExist","Logger","DeepCopier","PrecisionDate","_WarnImport","WebRequest","EngineStore","FileToolsOptions","DecodeBase64UrlToBinary","IsBase64DataUrl","LoadFile","FileToolsLoadFile","LoadImage","FileToolLoadImage","ReadFile","FileToolsReadFile","SetCorsBehavior","TimingTools","InstantiationTools","RandomGUID","Tools","BaseUrl","value","IsAbsoluteUrl","url","indexOf","ScriptBaseUrl","ScriptPreprocessUrl","func","DefaultRetryStrategy","strategy","CorsBehavior","UseFallbackTexture","RegisteredExternalClasses","classes","fallbackTexture","FallbackTexture","FetchToRef","u","v","width","height","pixels","color","wrappedU","Math","abs","wrappedV","position","r","g","b","a","Mix","alpha","Instantiate","className","SetImmediate","action","IsExponentOfTwo","count","FloatRound","fround","GetFilename","path","index","lastIndexOf","substring","GetFolderPath","uri","returnUnchangedIfNoSlash","ToDegrees","angle","PI","ToRadians","SmoothAngleChange","previousAngle","newAngle","smoothFactor","previousAngleRad","newAngleRad","atan2","sin","cos","MakeArray","obj","allowsNullUndefined","undefined","Array","isArray","GetPointerPrefix","engine","eventPrefix","window","PointerEvent","_badDesktopOS","_badOS","document","element","SetReferrerPolicyBehavior","referrerPolicy","CleanUrl","replace","PreprocessUrl","processor","input","onLoad","onError","offlineProvider","mimeType","imageBitmapOptions","onSuccess","onProgress","useArrayBuffer","LoadFileAsync","Promise","resolve","reject","data","request","exception","GetBabylonScriptURL","scriptUrl","forceAbsoluteUrl","baseUrl","length","GetAbsoluteUrl","LoadBabylonScript","scriptId","LoadScript","LoadBabylonScriptAsync","LoadScriptAsync","importScripts","e","head","getElementsByTagName","script","createElement","setAttribute","id","onload","onerror","appendChild","message","Error","ReadFileAsDataURL","fileToLoad","callback","progressCallback","reader","FileReader","onCompleteObservable","abort","onloadend","notifyObservers","target","onprogress","readAsDataURL","file","FileAsURL","content","fileBlob","Blob","URL","link","createObjectURL","Format","decimals","toFixed","DeepCopy","source","destination","doNotCopyList","mustCopyList","IsEmpty","i","Object","prototype","hasOwnProperty","call","RegisterTopRootEvents","windowElement","events","event","addEventListener","name","handler","parent","UnregisterTopRootEvents","removeEventListener","DumpFramebuffer","successCallback","fileName","quality","DumpData","invertY","toArrayBuffer","DumpDataAsync","_IsOffScreenCanvas","canvas","convertToBlob","ToBlob","toBlob","type","setTimeout","binStr","atob","toDataURL","split","len","arr","Uint8Array","charCodeAt","then","blob","DownloadBlob","date","Date","stringDate","getFullYear","getMonth","slice","getDate","getHours","getMinutes","Download","newWindow","open","img","revokeObjectURL","src","body","EncodeScreenshotCanvasData","base64data","result","base64Image","style","display","href","download","parentElement","removeChild","click","BackCompatCameraNoPreventDefault","args","CreateScreenshot","camera","size","forceDownload","CreateScreenshotAsync","CreateScreenshotUsingRenderTarget","samples","antialiasing","renderSprites","enableStencilBuffer","useLayerMask","CreateScreenshotUsingRenderTargetAsync","RandomId","IsBase64","DecodeBase64","errorsCount","Log","Warn","LogCache","ClearLogCache","LogLevels","level","PerformanceLogLevel","PerformanceUserMarkLogLevel","StartPerformanceCounter","_StartUserMark","EndPerformanceCounter","_EndUserMark","PerformanceConsoleLogLevel","_StartPerformanceConsole","_EndPerformanceConsole","_StartPerformanceCounterDisabled","_EndPerformanceCounterDisabled","counterName","condition","_Performance","performance","mark","measure","console","time","timeEnd","Now","GetClassName","object","isType","getClassName","classObj","getPrototypeOf","constructor","First","array","predicate","el","getFullClassName","moduleName","DelayAsync","delay","IsSafari","test","navigator","userAgent","UseCustomRequestHeaders","CustomRequestHeaders","location","origin","NoneLogLevel","MessageLogLevel","WarningLogLevel","ErrorLogLevel","AllLogLevel","PerformanceNoneLogLevel","module","AsyncLoop","iterations","offset","_done","_fn","_successCallback","executeNext","breakLoop","Run","fn","loop","SyncAsyncForLoop","syncedIterations","breakFunction","timeout","ceil","iteration"],"sources":["../../../../dev/core/src/Misc/tools.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport type { Nullable } from \"../types\";\r\nimport { Observable } from \"./observable\";\r\nimport { GetDOMTextContent, IsNavigatorAvailable, IsWindowObjectExist } from \"./domManagement\";\r\nimport { Logger } from \"./logger\";\r\nimport { DeepCopier } from \"./deepCopier\";\r\nimport { PrecisionDate } from \"./precisionDate\";\r\nimport { _WarnImport } from \"./devTools\";\r\nimport { WebRequest } from \"./webRequest\";\r\nimport type { IFileRequest } from \"./fileRequest\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport type { ReadFileError } from \"./fileTools\";\r\nimport {\r\n    FileToolsOptions,\r\n    DecodeBase64UrlToBinary,\r\n    IsBase64DataUrl,\r\n    LoadFile as FileToolsLoadFile,\r\n    LoadImage as FileToolLoadImage,\r\n    ReadFile as FileToolsReadFile,\r\n    SetCorsBehavior,\r\n} from \"./fileTools\";\r\nimport type { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport { TimingTools } from \"./timingTools\";\r\nimport { InstantiationTools } from \"./instantiationTools\";\r\nimport { RandomGUID } from \"./guid\";\r\nimport type { IScreenshotSize } from \"./interfaces/screenshotSize\";\r\nimport type { Engine } from \"../Engines/engine\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\nimport type { IColor4Like } from \"../Maths/math.like\";\r\n\r\ndeclare function importScripts(...urls: string[]): void;\r\n\r\n/**\r\n * Class containing a set of static utilities functions\r\n */\r\nexport class Tools {\r\n    /**\r\n     * Gets or sets the base URL to use to load assets\r\n     */\r\n    public static get BaseUrl() {\r\n        return FileToolsOptions.BaseUrl;\r\n    }\r\n\r\n    public static set BaseUrl(value: string) {\r\n        FileToolsOptions.BaseUrl = value;\r\n    }\r\n\r\n    /**\r\n     * This function checks whether a URL is absolute or not.\r\n     * It will also detect data and blob URLs\r\n     * @param url the url to check\r\n     * @returns is the url absolute or relative\r\n     */\r\n    public static IsAbsoluteUrl(url: string): boolean {\r\n        // See https://stackoverflow.com/a/38979205.\r\n\r\n        // URL is protocol-relative (= absolute)\r\n        if (url.indexOf(\"//\") === 0) {\r\n            return true;\r\n        }\r\n\r\n        // URL has no protocol (= relative)\r\n        if (url.indexOf(\"://\") === -1) {\r\n            return false;\r\n        }\r\n\r\n        // URL does not contain a dot, i.e. no TLD (= relative, possibly REST)\r\n        if (url.indexOf(\".\") === -1) {\r\n            return false;\r\n        }\r\n\r\n        // URL does not contain a single slash (= relative)\r\n        if (url.indexOf(\"/\") === -1) {\r\n            return false;\r\n        }\r\n\r\n        // The first colon comes after the first slash (= relative)\r\n        if (url.indexOf(\":\") > url.indexOf(\"/\")) {\r\n            return false;\r\n        }\r\n\r\n        // Protocol is defined before first dot (= absolute)\r\n        if (url.indexOf(\"://\") < url.indexOf(\".\")) {\r\n            return true;\r\n        }\r\n        if (url.indexOf(\"data:\") === 0 || url.indexOf(\"blob:\") === 0) {\r\n            return true;\r\n        }\r\n\r\n        // Anything else must be relative\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Sets the base URL to use to load scripts\r\n     */\r\n    public static set ScriptBaseUrl(value: string) {\r\n        FileToolsOptions.ScriptBaseUrl = value;\r\n    }\r\n\r\n    public static get ScriptBaseUrl(): string {\r\n        return FileToolsOptions.ScriptBaseUrl;\r\n    }\r\n\r\n    /**\r\n     * Sets a preprocessing function to run on a source URL before importing it\r\n     * Note that this function will execute AFTER the base URL is appended to the URL\r\n     */\r\n    public static set ScriptPreprocessUrl(func: (source: string) => string) {\r\n        FileToolsOptions.ScriptPreprocessUrl = func;\r\n    }\r\n\r\n    public static get ScriptPreprocessUrl(): (source: string) => string {\r\n        return FileToolsOptions.ScriptPreprocessUrl;\r\n    }\r\n\r\n    /**\r\n     * Enable/Disable Custom HTTP Request Headers globally.\r\n     * default = false\r\n     * @see CustomRequestHeaders\r\n     */\r\n    public static UseCustomRequestHeaders = false;\r\n\r\n    /**\r\n     * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n     * i.e. when loading files, where the server/service expects an Authorization header\r\n     */\r\n    public static CustomRequestHeaders = WebRequest.CustomRequestHeaders;\r\n\r\n    /**\r\n     * Gets or sets the retry strategy to apply when an error happens while loading an asset\r\n     */\r\n    public static get DefaultRetryStrategy() {\r\n        return FileToolsOptions.DefaultRetryStrategy;\r\n    }\r\n\r\n    public static set DefaultRetryStrategy(strategy: (url: string, request: WebRequest, retryIndex: number) => number) {\r\n        FileToolsOptions.DefaultRetryStrategy = strategy;\r\n    }\r\n\r\n    /**\r\n     * Default behavior for cors in the application.\r\n     * It can be a string if the expected behavior is identical in the entire app.\r\n     * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\r\n     */\r\n    public static get CorsBehavior(): string | ((url: string | string[]) => string) {\r\n        return FileToolsOptions.CorsBehavior;\r\n    }\r\n\r\n    public static set CorsBehavior(value: string | ((url: string | string[]) => string)) {\r\n        FileToolsOptions.CorsBehavior = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\r\n     * @ignorenaming\r\n     */\r\n    public static get UseFallbackTexture() {\r\n        return EngineStore.UseFallbackTexture;\r\n    }\r\n\r\n    public static set UseFallbackTexture(value: boolean) {\r\n        EngineStore.UseFallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Use this object to register external classes like custom textures or material\r\n     * to allow the loaders to instantiate them\r\n     */\r\n    public static get RegisteredExternalClasses() {\r\n        return InstantiationTools.RegisteredExternalClasses;\r\n    }\r\n\r\n    public static set RegisteredExternalClasses(classes: { [key: string]: Object }) {\r\n        InstantiationTools.RegisteredExternalClasses = classes;\r\n    }\r\n\r\n    /**\r\n     * Texture content used if a texture cannot loaded\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static get fallbackTexture() {\r\n        return EngineStore.FallbackTexture;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static set fallbackTexture(value: string) {\r\n        EngineStore.FallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Read the content of a byte array at a specified coordinates (taking in account wrapping)\r\n     * @param u defines the coordinate on X axis\r\n     * @param v defines the coordinate on Y axis\r\n     * @param width defines the width of the source data\r\n     * @param height defines the height of the source data\r\n     * @param pixels defines the source byte array\r\n     * @param color defines the output color\r\n     */\r\n    public static FetchToRef(u: number, v: number, width: number, height: number, pixels: Uint8Array, color: IColor4Like): void {\r\n        const wrappedU = (Math.abs(u) * width) % width | 0;\r\n        const wrappedV = (Math.abs(v) * height) % height | 0;\r\n\r\n        const position = (wrappedU + wrappedV * width) * 4;\r\n        color.r = pixels[position] / 255;\r\n        color.g = pixels[position + 1] / 255;\r\n        color.b = pixels[position + 2] / 255;\r\n        color.a = pixels[position + 3] / 255;\r\n    }\r\n\r\n    /**\r\n     * Interpolates between a and b via alpha\r\n     * @param a The lower value (returned when alpha = 0)\r\n     * @param b The upper value (returned when alpha = 1)\r\n     * @param alpha The interpolation-factor\r\n     * @returns The mixed value\r\n     */\r\n    public static Mix(a: number, b: number, alpha: number): number {\r\n        return a * (1 - alpha) + b * alpha;\r\n    }\r\n\r\n    /**\r\n     * Tries to instantiate a new object from a given class name\r\n     * @param className defines the class name to instantiate\r\n     * @returns the new object or null if the system was not able to do the instantiation\r\n     */\r\n    public static Instantiate(className: string): any {\r\n        return InstantiationTools.Instantiate(className);\r\n    }\r\n\r\n    /**\r\n     * Polyfill for setImmediate\r\n     * @param action defines the action to execute after the current execution block\r\n     */\r\n    public static SetImmediate(action: () => void) {\r\n        TimingTools.SetImmediate(action);\r\n    }\r\n\r\n    /**\r\n     * Function indicating if a number is an exponent of 2\r\n     * @param value defines the value to test\r\n     * @returns true if the value is an exponent of 2\r\n     */\r\n    public static IsExponentOfTwo(value: number): boolean {\r\n        let count = 1;\r\n\r\n        do {\r\n            count *= 2;\r\n        } while (count < value);\r\n\r\n        return count === value;\r\n    }\r\n\r\n    /**\r\n     * Returns the nearest 32-bit single precision float representation of a Number\r\n     * @param value A Number.  If the parameter is of a different type, it will get converted\r\n     * to a number or to NaN if it cannot be converted\r\n     * @returns number\r\n     */\r\n    public static FloatRound(value: number): number {\r\n        return Math.fround(value);\r\n    }\r\n\r\n    /**\r\n     * Extracts the filename from a path\r\n     * @param path defines the path to use\r\n     * @returns the filename\r\n     */\r\n    public static GetFilename(path: string): string {\r\n        const index = path.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            return path;\r\n        }\r\n\r\n        return path.substring(index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts the \"folder\" part of a path (everything before the filename).\r\n     * @param uri The URI to extract the info from\r\n     * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\r\n     * @returns The \"folder\" part of the path\r\n     */\r\n    public static GetFolderPath(uri: string, returnUnchangedIfNoSlash = false): string {\r\n        const index = uri.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            if (returnUnchangedIfNoSlash) {\r\n                return uri;\r\n            }\r\n            return \"\";\r\n        }\r\n\r\n        return uri.substring(0, index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts text content from a DOM element hierarchy\r\n     * Back Compat only, please use GetDOMTextContent instead.\r\n     */\r\n    public static GetDOMTextContent = GetDOMTextContent;\r\n\r\n    /**\r\n     * Convert an angle in radians to degrees\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in degrees\r\n     */\r\n    public static ToDegrees(angle: number): number {\r\n        return (angle * 180) / Math.PI;\r\n    }\r\n\r\n    /**\r\n     * Convert an angle in degrees to radians\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in radians\r\n     */\r\n    public static ToRadians(angle: number): number {\r\n        return (angle * Math.PI) / 180;\r\n    }\r\n\r\n    /**\r\n     * Smooth angle changes (kind of low-pass filter), in particular for device orientation \"shaking\"\r\n     * Use trigonometric functions to avoid discontinuity (0/360, -180/180)\r\n     * @param previousAngle defines last angle value, in degrees\r\n     * @param newAngle defines new angle value, in degrees\r\n     * @param smoothFactor defines smoothing sensitivity; min 0: no smoothing, max 1: new data ignored\r\n     * @returns the angle in degrees\r\n     */\r\n    public static SmoothAngleChange(previousAngle: number, newAngle: number, smoothFactor = 0.9): number {\r\n        const previousAngleRad = this.ToRadians(previousAngle);\r\n        const newAngleRad = this.ToRadians(newAngle);\r\n        return this.ToDegrees(\r\n            Math.atan2(\r\n                (1 - smoothFactor) * Math.sin(newAngleRad) + smoothFactor * Math.sin(previousAngleRad),\r\n                (1 - smoothFactor) * Math.cos(newAngleRad) + smoothFactor * Math.cos(previousAngleRad)\r\n            )\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns an array if obj is not an array\r\n     * @param obj defines the object to evaluate as an array\r\n     * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\r\n     * @returns either obj directly if obj is an array or a new array containing obj\r\n     */\r\n    public static MakeArray(obj: any, allowsNullUndefined?: boolean): Nullable<Array<any>> {\r\n        if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\r\n            return null;\r\n        }\r\n\r\n        return Array.isArray(obj) ? obj : [obj];\r\n    }\r\n\r\n    /**\r\n     * Gets the pointer prefix to use\r\n     * @param engine defines the engine we are finding the prefix for\r\n     * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\r\n     */\r\n    public static GetPointerPrefix(engine: Engine): string {\r\n        let eventPrefix = \"pointer\";\r\n\r\n        // Check if pointer events are supported\r\n        if (IsWindowObjectExist() && !window.PointerEvent) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        // Special Fallback MacOS Safari...\r\n        if (\r\n            engine._badDesktopOS &&\r\n            !engine._badOS &&\r\n            // And not ipad pros who claim to be macs...\r\n            !(document && \"ontouchend\" in document)\r\n        ) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        return eventPrefix;\r\n    }\r\n\r\n    /**\r\n     * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\r\n     * @param url define the url we are trying\r\n     * @param element define the dom element where to configure the cors policy\r\n     * @param element.crossOrigin\r\n     */\r\n    public static SetCorsBehavior(url: string | string[], element: { crossOrigin: string | null }): void {\r\n        SetCorsBehavior(url, element);\r\n    }\r\n\r\n    /**\r\n     * Sets the referrerPolicy behavior on a dom element.\r\n     * @param referrerPolicy define the referrer policy to use\r\n     * @param element define the dom element where to configure the referrer policy\r\n     * @param element.referrerPolicy\r\n     */\r\n    public static SetReferrerPolicyBehavior(referrerPolicy: Nullable<ReferrerPolicy>, element: { referrerPolicy: string | null }): void {\r\n        element.referrerPolicy = referrerPolicy;\r\n    }\r\n\r\n    // External files\r\n\r\n    /**\r\n     * Removes unwanted characters from an url\r\n     * @param url defines the url to clean\r\n     * @returns the cleaned url\r\n     */\r\n    public static CleanUrl(url: string): string {\r\n        url = url.replace(/#/gm, \"%23\");\r\n        return url;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a function used to pre-process url before using them to load assets\r\n     */\r\n    public static get PreprocessUrl() {\r\n        return FileToolsOptions.PreprocessUrl;\r\n    }\r\n\r\n    public static set PreprocessUrl(processor: (url: string) => string) {\r\n        FileToolsOptions.PreprocessUrl = processor;\r\n    }\r\n\r\n    /**\r\n     * Loads an image as an HTMLImageElement.\r\n     * @param input url string, ArrayBuffer, or Blob to load\r\n     * @param onLoad callback called when the image successfully loads\r\n     * @param onError callback called when the image fails to load\r\n     * @param offlineProvider offline provider for caching\r\n     * @param mimeType optional mime type\r\n     * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\r\n     * @returns the HTMLImageElement of the loaded image\r\n     */\r\n    public static LoadImage(\r\n        input: string | ArrayBuffer | Blob,\r\n        onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n        onError: (message?: string, exception?: any) => void,\r\n        offlineProvider: Nullable<IOfflineProvider>,\r\n        mimeType?: string,\r\n        imageBitmapOptions?: ImageBitmapOptions\r\n    ): Nullable<HTMLImageElement> {\r\n        return FileToolLoadImage(input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url string, ArrayBuffer, or Blob to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     */\r\n    public static LoadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (data: any) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: WebRequest, exception?: any) => void\r\n    ): IFileRequest {\r\n        return FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url the file url to load\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @returns a promise containing an ArrayBuffer corresponding to the loaded file\r\n     */\r\n    public static LoadFileAsync(url: string, useArrayBuffer = true): Promise<ArrayBuffer | string> {\r\n        return new Promise((resolve, reject) => {\r\n            FileToolsLoadFile(\r\n                url,\r\n                (data) => {\r\n                    resolve(data);\r\n                },\r\n                undefined,\r\n                undefined,\r\n                useArrayBuffer,\r\n                (request, exception) => {\r\n                    reject(exception);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get a script URL including preprocessing\r\n     * @param scriptUrl the script Url to process\r\n     * @returns a modified URL to use\r\n     */\r\n    public static GetBabylonScriptURL(scriptUrl: Nullable<string>, forceAbsoluteUrl?: boolean): string {\r\n        if (!scriptUrl) {\r\n            return \"\";\r\n        }\r\n        // check if the URL is absolute or relative. Otherwise, append the base URL\r\n        if (!Tools.IsAbsoluteUrl(scriptUrl)) {\r\n            const baseUrl = Tools.ScriptBaseUrl[Tools.ScriptBaseUrl.length - 1] === \"/\" ? Tools.ScriptBaseUrl : Tools.ScriptBaseUrl + \"/\";\r\n            scriptUrl = baseUrl + (scriptUrl[0] === \"/\" ? scriptUrl.substring(1) : scriptUrl);\r\n        }\r\n\r\n        // run the preprocessor\r\n        scriptUrl = Tools.ScriptPreprocessUrl(scriptUrl);\r\n\r\n        if (forceAbsoluteUrl) {\r\n            scriptUrl = Tools.GetAbsoluteUrl(scriptUrl);\r\n        }\r\n\r\n        return scriptUrl;\r\n    }\r\n\r\n    /**\r\n     * This function is used internally by babylon components to load a script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to load\r\n     * @param onSuccess defines the callback called when the script is loaded\r\n     * @param onError defines the callback to call if an error occurs\r\n     * @param scriptId defines the id of the script element\r\n     */\r\n    public static LoadBabylonScript(scriptUrl: string, onSuccess: () => void, onError?: (message?: string, exception?: any) => void, scriptId?: string) {\r\n        scriptUrl = Tools.GetBabylonScriptURL(scriptUrl);\r\n        Tools.LoadScript(scriptUrl, onSuccess, onError);\r\n    }\r\n\r\n    /**\r\n     * Load an asynchronous script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @returns a promise request object\r\n     */\r\n    public static LoadBabylonScriptAsync(scriptUrl: string): Promise<void> {\r\n        scriptUrl = Tools.GetBabylonScriptURL(scriptUrl);\r\n        return Tools.LoadScriptAsync(scriptUrl);\r\n    }\r\n\r\n    /**\r\n     * This function is used internally by babylon components to load a script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to load\r\n     * @param onSuccess defines the callback called when the script is loaded\r\n     * @param onError defines the callback to call if an error occurs\r\n     * @param scriptId defines the id of the script element\r\n     */\r\n    public static LoadScript(scriptUrl: string, onSuccess: () => void, onError?: (message?: string, exception?: any) => void, scriptId?: string) {\r\n        if (typeof importScripts === \"function\") {\r\n            try {\r\n                importScripts(scriptUrl);\r\n                onSuccess();\r\n            } catch (e) {\r\n                onError?.(`Unable to load script '${scriptUrl}' in worker`, e);\r\n            }\r\n            return;\r\n        } else if (!IsWindowObjectExist()) {\r\n            onError?.(`Cannot load script '${scriptUrl}' outside of a window or a worker`);\r\n            return;\r\n        }\r\n        const head = document.getElementsByTagName(\"head\")[0];\r\n        const script = document.createElement(\"script\");\r\n        script.setAttribute(\"type\", \"text/javascript\");\r\n        script.setAttribute(\"src\", scriptUrl);\r\n        if (scriptId) {\r\n            script.id = scriptId;\r\n        }\r\n\r\n        script.onload = () => {\r\n            if (onSuccess) {\r\n                onSuccess();\r\n            }\r\n        };\r\n\r\n        script.onerror = (e) => {\r\n            if (onError) {\r\n                onError(`Unable to load script '${scriptUrl}'`, e);\r\n            }\r\n        };\r\n\r\n        head.appendChild(script);\r\n    }\r\n\r\n    /**\r\n     * Load an asynchronous script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @returns a promise request object\r\n     */\r\n    public static LoadScriptAsync(scriptUrl: string): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            this.LoadScript(\r\n                scriptUrl,\r\n                () => {\r\n                    resolve();\r\n                },\r\n                (message, exception) => {\r\n                    reject(exception || new Error(message));\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a blob\r\n     * @param fileToLoad defines the blob to use\r\n     * @param callback defines the callback to call when data is loaded\r\n     * @param progressCallback defines the callback to call during loading process\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFileAsDataURL(fileToLoad: Blob, callback: (data: any) => void, progressCallback: (ev: ProgressEvent) => any): IFileRequest {\r\n        const reader = new FileReader();\r\n\r\n        const request: IFileRequest = {\r\n            onCompleteObservable: new Observable<IFileRequest>(),\r\n            abort: () => reader.abort(),\r\n        };\r\n\r\n        reader.onloadend = () => {\r\n            request.onCompleteObservable.notifyObservers(request);\r\n        };\r\n\r\n        reader.onload = (e) => {\r\n            //target doesn't have result from ts 1.3\r\n            callback((<any>e.target)[\"result\"]);\r\n        };\r\n\r\n        reader.onprogress = progressCallback;\r\n\r\n        reader.readAsDataURL(fileToLoad);\r\n\r\n        return request;\r\n    }\r\n\r\n    /**\r\n     * Reads a file from a File object\r\n     * @param file defines the file to load\r\n     * @param onSuccess defines the callback to call when data is loaded\r\n     * @param onProgress defines the callback to call during loading process\r\n     * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\r\n     * @param onError defines the callback to call when an error occurs\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFile(\r\n        file: File,\r\n        onSuccess: (data: any) => void,\r\n        onProgress?: (ev: ProgressEvent) => any,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (error: ReadFileError) => void\r\n    ): IFileRequest {\r\n        return FileToolsReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\r\n    }\r\n\r\n    /**\r\n     * Creates a data url from a given string content\r\n     * @param content defines the content to convert\r\n     * @returns the new data url link\r\n     */\r\n    public static FileAsURL(content: string): string {\r\n        const fileBlob = new Blob([content]);\r\n        const url = window.URL;\r\n        const link: string = url.createObjectURL(fileBlob);\r\n        return link;\r\n    }\r\n\r\n    /**\r\n     * Format the given number to a specific decimal format\r\n     * @param value defines the number to format\r\n     * @param decimals defines the number of decimals to use\r\n     * @returns the formatted string\r\n     */\r\n    public static Format(value: number, decimals = 2): string {\r\n        return value.toFixed(decimals);\r\n    }\r\n\r\n    /**\r\n     * Tries to copy an object by duplicating every property\r\n     * @param source defines the source object\r\n     * @param destination defines the target object\r\n     * @param doNotCopyList defines a list of properties to avoid\r\n     * @param mustCopyList defines a list of properties to copy (even if they start with _)\r\n     */\r\n    public static DeepCopy(source: any, destination: any, doNotCopyList?: string[], mustCopyList?: string[]): void {\r\n        DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the given object has no own property\r\n     * @param obj defines the object to test\r\n     * @returns true if object has no own property\r\n     */\r\n    public static IsEmpty(obj: any): boolean {\r\n        for (const i in obj) {\r\n            if (Object.prototype.hasOwnProperty.call(obj, i)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Function used to register events at window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to register\r\n     */\r\n    public static RegisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (let index = 0; index < events.length; index++) {\r\n            const event = events[index];\r\n            windowElement.addEventListener(event.name, <any>event.handler, false);\r\n\r\n            try {\r\n                if (window.parent) {\r\n                    window.parent.addEventListener(event.name, <any>event.handler, false);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Function used to unregister events from window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to unregister\r\n     */\r\n    public static UnregisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (let index = 0; index < events.length; index++) {\r\n            const event = events[index];\r\n            windowElement.removeEventListener(event.name, <any>event.handler);\r\n\r\n            try {\r\n                if (windowElement.parent) {\r\n                    windowElement.parent.removeEventListener(event.name, <any>event.handler);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dumps the current bound framebuffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param engine defines the hosting engine\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * @returns a void promise\r\n     */\r\n    public static async DumpFramebuffer(\r\n        width: number,\r\n        height: number,\r\n        engine: Engine,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        quality?: number\r\n    ) {\r\n        throw _WarnImport(\"DumpTools\");\r\n    }\r\n\r\n    /**\r\n     * Dumps an array buffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param data the data array\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param invertY true to invert the picture in the Y dimension\r\n     * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    public static DumpData(\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        successCallback?: (data: string | ArrayBuffer) => void,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        invertY = false,\r\n        toArrayBuffer = false,\r\n        quality?: number\r\n    ) {\r\n        throw _WarnImport(\"DumpTools\");\r\n    }\r\n\r\n    /**\r\n     * Dumps an array buffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param data the data array\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param invertY true to invert the picture in the Y dimension\r\n     * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * @returns a promise that resolve to the final data\r\n     */\r\n    public static DumpDataAsync(\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        invertY = false,\r\n        toArrayBuffer = false,\r\n        quality?: number\r\n    ): Promise<string | ArrayBuffer> {\r\n        throw _WarnImport(\"DumpTools\");\r\n    }\r\n\r\n    private static _IsOffScreenCanvas(canvas: HTMLCanvasElement | OffscreenCanvas): canvas is OffscreenCanvas {\r\n        return (canvas as OffscreenCanvas).convertToBlob !== undefined;\r\n    }\r\n\r\n    /**\r\n     * Converts the canvas data to blob.\r\n     * This acts as a polyfill for browsers not supporting the to blob function.\r\n     * @param canvas Defines the canvas to extract the data from (can be an offscreen canvas)\r\n     * @param successCallback Defines the callback triggered once the data are available\r\n     * @param mimeType Defines the mime type of the result\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    static ToBlob(canvas: HTMLCanvasElement | OffscreenCanvas, successCallback: (blob: Nullable<Blob>) => void, mimeType = \"image/png\", quality?: number): void {\r\n        // We need HTMLCanvasElement.toBlob for HD screenshots\r\n        if (!Tools._IsOffScreenCanvas(canvas) && !canvas.toBlob) {\r\n            //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\r\n            canvas.toBlob = function (callback, type, quality) {\r\n                setTimeout(() => {\r\n                    const binStr = atob(this.toDataURL(type, quality).split(\",\")[1]),\r\n                        len = binStr.length,\r\n                        arr = new Uint8Array(len);\r\n\r\n                    for (let i = 0; i < len; i++) {\r\n                        arr[i] = binStr.charCodeAt(i);\r\n                    }\r\n                    callback(new Blob([arr]));\r\n                });\r\n            };\r\n        }\r\n        if (Tools._IsOffScreenCanvas(canvas)) {\r\n            canvas\r\n                .convertToBlob({\r\n                    type: mimeType,\r\n                    quality,\r\n                })\r\n                .then((blob) => successCallback(blob));\r\n        } else {\r\n            canvas.toBlob(\r\n                function (blob) {\r\n                    successCallback(blob);\r\n                },\r\n                mimeType,\r\n                quality\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Download a Blob object\r\n     * @param blob the Blob object\r\n     * @param fileName the file name to download\r\n     * @returns\r\n     */\r\n    static DownloadBlob(blob: Blob, fileName?: string) {\r\n        //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\r\n        if (\"download\" in document.createElement(\"a\")) {\r\n            if (!fileName) {\r\n                const date = new Date();\r\n                const stringDate =\r\n                    (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) + \"-\" + date.getDate() + \"_\" + date.getHours() + \"-\" + (\"0\" + date.getMinutes()).slice(-2);\r\n                fileName = \"screenshot_\" + stringDate + \".png\";\r\n            }\r\n            Tools.Download(blob, fileName);\r\n        } else {\r\n            if (blob && typeof URL !== \"undefined\") {\r\n                const url = URL.createObjectURL(blob);\r\n\r\n                const newWindow = window.open(\"\");\r\n                if (!newWindow) {\r\n                    return;\r\n                }\r\n                const img = newWindow.document.createElement(\"img\");\r\n                img.onload = function () {\r\n                    // no longer need to read the blob so it's revoked\r\n                    URL.revokeObjectURL(url);\r\n                };\r\n                img.src = url;\r\n                newWindow.document.body.appendChild(img);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Encodes the canvas data to base 64, or automatically downloads the result if `fileName` is defined.\r\n     * @param canvas The canvas to get the data from, which can be an offscreen canvas.\r\n     * @param successCallback The callback which is triggered once the data is available. If `fileName` is defined, the callback will be invoked after the download occurs, and the `data` argument will be an empty string.\r\n     * @param mimeType The mime type of the result.\r\n     * @param fileName The name of the file to download. If defined, the result will automatically be downloaded. If not defined, and `successCallback` is also not defined, the result will automatically be downloaded with an auto-generated file name.\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    static EncodeScreenshotCanvasData(\r\n        canvas: HTMLCanvasElement | OffscreenCanvas,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        quality?: number\r\n    ): void {\r\n        if (typeof fileName === \"string\" || !successCallback) {\r\n            this.ToBlob(\r\n                canvas,\r\n                function (blob) {\r\n                    if (blob) {\r\n                        Tools.DownloadBlob(blob, fileName);\r\n                    }\r\n                    if (successCallback) {\r\n                        successCallback(\"\");\r\n                    }\r\n                },\r\n                mimeType,\r\n                quality\r\n            );\r\n        } else if (successCallback) {\r\n            if (Tools._IsOffScreenCanvas(canvas)) {\r\n                canvas\r\n                    .convertToBlob({\r\n                        type: mimeType,\r\n                        quality,\r\n                    })\r\n                    .then((blob) => {\r\n                        const reader = new FileReader();\r\n                        reader.readAsDataURL(blob);\r\n                        reader.onloadend = () => {\r\n                            const base64data = reader.result;\r\n                            successCallback(base64data as string);\r\n                        };\r\n                    });\r\n                return;\r\n            }\r\n            const base64Image = canvas.toDataURL(mimeType, quality);\r\n            successCallback(base64Image);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Downloads a blob in the browser\r\n     * @param blob defines the blob to download\r\n     * @param fileName defines the name of the downloaded file\r\n     */\r\n    public static Download(blob: Blob, fileName: string): void {\r\n        if (typeof URL === \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        a.style.display = \"none\";\r\n        a.href = url;\r\n        a.download = fileName;\r\n        a.addEventListener(\"click\", () => {\r\n            if (a.parentElement) {\r\n                a.parentElement.removeChild(a);\r\n            }\r\n        });\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n    }\r\n\r\n    /**\r\n     * Will return the right value of the noPreventDefault variable\r\n     * Needed to keep backwards compatibility to the old API.\r\n     *\r\n     * @param args arguments passed to the attachControl function\r\n     * @returns the correct value for noPreventDefault\r\n     */\r\n    public static BackCompatCameraNoPreventDefault(args: IArguments): boolean {\r\n        // is it used correctly?\r\n        if (typeof args[0] === \"boolean\") {\r\n            return args[0];\r\n        } else if (typeof args[1] === \"boolean\") {\r\n            return args[1];\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback defines the callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param forceDownload force the system to download the image even if a successCallback is provided\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshot(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        forceDownload = false,\r\n        quality?: number\r\n    ): void {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotAsync(engine: Engine, camera: Camera, size: IScreenshotSize | number, mimeType = \"image/png\", quality?: number): Promise<string> {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback The callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     * @param renderSprites Whether the sprites should be rendered or not (default: false)\r\n     * @param enableStencilBuffer Whether the stencil buffer should be enabled or not (default: false)\r\n     * @param useLayerMask if the camera's layer mask should be used to filter what should be rendered (default: true)\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotUsingRenderTarget(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        samples = 1,\r\n        antialiasing = false,\r\n        fileName?: string,\r\n        renderSprites = false,\r\n        enableStencilBuffer = false,\r\n        useLayerMask = true,\r\n        quality?: number\r\n    ): void {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * @param renderSprites Whether the sprites should be rendered or not (default: false)\r\n     * @param enableStencilBuffer Whether the stencil buffer should be enabled or not (default: false)\r\n     * @param useLayerMask if the camera's layer mask should be used to filter what should be rendered (default: true)\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotUsingRenderTargetAsync(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        mimeType = \"image/png\",\r\n        samples = 1,\r\n        antialiasing = false,\r\n        fileName?: string,\r\n        renderSprites = false,\r\n        enableStencilBuffer = false,\r\n        useLayerMask = true,\r\n        quality?: number\r\n    ): Promise<string> {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n     * Be aware Math.random() could cause collisions, but:\r\n     * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n     * @returns a pseudo random id\r\n     */\r\n    public static RandomId(): string {\r\n        return RandomGUID();\r\n    }\r\n\r\n    /**\r\n     * Test if the given uri is a base64 string\r\n     * @deprecated Please use FileTools.IsBase64DataUrl instead.\r\n     * @param uri The uri to test\r\n     * @returns True if the uri is a base64 string or false otherwise\r\n     */\r\n    public static IsBase64(uri: string): boolean {\r\n        return IsBase64DataUrl(uri);\r\n    }\r\n\r\n    /**\r\n     * Decode the given base64 uri.\r\n     * @deprecated Please use FileTools.DecodeBase64UrlToBinary instead.\r\n     * @param uri The uri to decode\r\n     * @returns The decoded base64 data.\r\n     */\r\n    public static DecodeBase64(uri: string): ArrayBuffer {\r\n        return DecodeBase64UrlToBinary(uri);\r\n    }\r\n\r\n    public static GetAbsoluteUrl: (url: string) => string =\r\n        typeof document === \"object\"\r\n            ? (url) => {\r\n                  const a = document.createElement(\"a\");\r\n                  a.href = url;\r\n                  return a.href;\r\n              }\r\n            : typeof URL === \"function\" && typeof location === \"object\"\r\n            ? (url) => new URL(url, location.origin).href\r\n            : () => {\r\n                  throw new Error(\"Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.\");\r\n              };\r\n\r\n    // Logs\r\n    /**\r\n     * No log\r\n     */\r\n    public static readonly NoneLogLevel = Logger.NoneLogLevel;\r\n    /**\r\n     * Only message logs\r\n     */\r\n    public static readonly MessageLogLevel = Logger.MessageLogLevel;\r\n    /**\r\n     * Only warning logs\r\n     */\r\n    public static readonly WarningLogLevel = Logger.WarningLogLevel;\r\n    /**\r\n     * Only error logs\r\n     */\r\n    public static readonly ErrorLogLevel = Logger.ErrorLogLevel;\r\n    /**\r\n     * All logs\r\n     */\r\n    public static readonly AllLogLevel = Logger.AllLogLevel;\r\n\r\n    /**\r\n     * Gets a value indicating the number of loading errors\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static get errorsCount(): number {\r\n        return Logger.errorsCount;\r\n    }\r\n\r\n    /**\r\n     * Callback called when a new log is added\r\n     */\r\n    public static OnNewCacheEntry: (entry: string) => void;\r\n\r\n    /**\r\n     * Log a message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Log(message: string): void {\r\n        Logger.Log(message);\r\n    }\r\n\r\n    /**\r\n     * Write a warning message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Warn(message: string): void {\r\n        Logger.Warn(message);\r\n    }\r\n\r\n    /**\r\n     * Write an error message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Error(message: string): void {\r\n        Logger.Error(message);\r\n    }\r\n\r\n    /**\r\n     * Gets current log cache (list of logs)\r\n     */\r\n    public static get LogCache(): string {\r\n        return Logger.LogCache;\r\n    }\r\n\r\n    /**\r\n     * Clears the log cache\r\n     */\r\n    public static ClearLogCache(): void {\r\n        Logger.ClearLogCache();\r\n    }\r\n\r\n    /**\r\n     * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\r\n     */\r\n    public static set LogLevels(level: number) {\r\n        Logger.LogLevels = level;\r\n    }\r\n\r\n    /**\r\n     * Checks if the window object exists\r\n     * Back Compat only, please use IsWindowObjectExist instead.\r\n     */\r\n    public static IsWindowObjectExist = IsWindowObjectExist;\r\n\r\n    // Performances\r\n\r\n    /**\r\n     * No performance log\r\n     */\r\n    public static readonly PerformanceNoneLogLevel = 0;\r\n    /**\r\n     * Use user marks to log performance\r\n     */\r\n    public static readonly PerformanceUserMarkLogLevel = 1;\r\n    /**\r\n     * Log performance to the console\r\n     */\r\n    public static readonly PerformanceConsoleLogLevel = 2;\r\n\r\n    private static _Performance: Performance;\r\n\r\n    /**\r\n     * Sets the current performance log level\r\n     */\r\n    public static set PerformanceLogLevel(level: number) {\r\n        if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartUserMark;\r\n            Tools.EndPerformanceCounter = Tools._EndUserMark;\r\n            return;\r\n        }\r\n\r\n        if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\r\n            Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\r\n            return;\r\n        }\r\n\r\n        Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\r\n        Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private static _StartPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private static _EndPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    private static _StartUserMark(counterName: string, condition = true): void {\r\n        if (!Tools._Performance) {\r\n            if (!IsWindowObjectExist()) {\r\n                return;\r\n            }\r\n            Tools._Performance = window.performance;\r\n        }\r\n\r\n        if (!condition || !Tools._Performance.mark) {\r\n            return;\r\n        }\r\n        Tools._Performance.mark(counterName + \"-Begin\");\r\n    }\r\n\r\n    private static _EndUserMark(counterName: string, condition = true): void {\r\n        if (!condition || !Tools._Performance.mark) {\r\n            return;\r\n        }\r\n        Tools._Performance.mark(counterName + \"-End\");\r\n        Tools._Performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\r\n    }\r\n\r\n    private static _StartPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._StartUserMark(counterName, condition);\r\n\r\n        if (console.time) {\r\n            console.time(counterName);\r\n        }\r\n    }\r\n\r\n    private static _EndPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._EndUserMark(counterName, condition);\r\n\r\n        console.timeEnd(counterName);\r\n    }\r\n\r\n    /**\r\n     * Starts a performance counter\r\n     */\r\n    public static StartPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._StartPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Ends a specific performance counter\r\n     */\r\n    public static EndPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._EndPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Gets either window.performance.now() if supported or Date.now() else\r\n     */\r\n    public static get Now(): number {\r\n        return PrecisionDate.Now;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the class used to create the instance of the given object.\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\r\n     */\r\n    public static GetClassName(object: any, isType = false): string {\r\n        let name = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            name = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                const classObj = isType ? object : Object.getPrototypeOf(object);\r\n                name = classObj.constructor[\"__bjsclassName__\"];\r\n            }\r\n            if (!name) {\r\n                name = typeof object;\r\n            }\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * Gets the first element of an array satisfying a given predicate\r\n     * @param array defines the array to browse\r\n     * @param predicate defines the predicate to use\r\n     * @returns null if not found or the element\r\n     */\r\n    public static First<T>(array: Array<T>, predicate: (item: T) => boolean): Nullable<T> {\r\n        for (const el of array) {\r\n            if (predicate(el)) {\r\n                return el;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the full name of the class, including its owning module (if any).\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @returns a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static getFullClassName(object: any, isType = false): Nullable<string> {\r\n        let className = null;\r\n        let moduleName = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            className = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                const classObj = isType ? object : Object.getPrototypeOf(object);\r\n                className = classObj.constructor[\"__bjsclassName__\"];\r\n                moduleName = classObj.constructor[\"__bjsmoduleName__\"];\r\n            }\r\n            if (!className) {\r\n                className = typeof object;\r\n            }\r\n        }\r\n\r\n        if (!className) {\r\n            return null;\r\n        }\r\n\r\n        return (moduleName != null ? moduleName + \".\" : \"\") + className;\r\n    }\r\n\r\n    /**\r\n     * Returns a promise that resolves after the given amount of time.\r\n     * @param delay Number of milliseconds to delay\r\n     * @returns Promise that resolves after the given amount of time\r\n     */\r\n    public static DelayAsync(delay: number): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, delay);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Utility function to detect if the current user agent is Safari\r\n     * @returns whether or not the current user agent is safari\r\n     */\r\n    public static IsSafari(): boolean {\r\n        if (!IsNavigatorAvailable()) {\r\n            return false;\r\n        }\r\n\r\n        return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n    }\r\n}\r\n\r\n/**\r\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\r\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\r\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\r\n * @param name The name of the class, case should be preserved\r\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\r\n */\r\nexport function className(name: string, module?: string): (target: Object) => void {\r\n    return (target: Object) => {\r\n        (<any>target)[\"__bjsclassName__\"] = name;\r\n        (<any>target)[\"__bjsmoduleName__\"] = module != null ? module : null;\r\n    };\r\n}\r\n\r\n/**\r\n * An implementation of a loop for asynchronous functions.\r\n */\r\nexport class AsyncLoop {\r\n    /**\r\n     * Defines the current index of the loop.\r\n     */\r\n    public index: number;\r\n    private _done: boolean;\r\n    private _fn: (asyncLoop: AsyncLoop) => void;\r\n    private _successCallback: () => void;\r\n\r\n    /**\r\n     * Constructor.\r\n     * @param iterations the number of iterations.\r\n     * @param func the function to run each iteration\r\n     * @param successCallback the callback that will be called upon successful execution\r\n     * @param offset starting offset.\r\n     */\r\n    constructor(\r\n        /**\r\n         * Defines the number of iterations for the loop\r\n         */\r\n        public iterations: number,\r\n        func: (asyncLoop: AsyncLoop) => void,\r\n        successCallback: () => void,\r\n        offset = 0\r\n    ) {\r\n        this.index = offset - 1;\r\n        this._done = false;\r\n        this._fn = func;\r\n        this._successCallback = successCallback;\r\n    }\r\n\r\n    /**\r\n     * Execute the next iteration. Must be called after the last iteration was finished.\r\n     */\r\n    public executeNext(): void {\r\n        if (!this._done) {\r\n            if (this.index + 1 < this.iterations) {\r\n                ++this.index;\r\n                this._fn(this);\r\n            } else {\r\n                this.breakLoop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Break the loop and run the success callback.\r\n     */\r\n    public breakLoop(): void {\r\n        this._done = true;\r\n        this._successCallback();\r\n    }\r\n\r\n    /**\r\n     * Create and run an async loop.\r\n     * @param iterations the number of iterations.\r\n     * @param fn the function to run each iteration\r\n     * @param successCallback the callback that will be called upon successful execution\r\n     * @param offset starting offset.\r\n     * @returns the created async loop object\r\n     */\r\n    public static Run(iterations: number, fn: (asyncLoop: AsyncLoop) => void, successCallback: () => void, offset = 0): AsyncLoop {\r\n        const loop = new AsyncLoop(iterations, fn, successCallback, offset);\r\n\r\n        loop.executeNext();\r\n\r\n        return loop;\r\n    }\r\n\r\n    /**\r\n     * A for-loop that will run a given number of iterations synchronous and the rest async.\r\n     * @param iterations total number of iterations\r\n     * @param syncedIterations number of synchronous iterations in each async iteration.\r\n     * @param fn the function to call each iteration.\r\n     * @param callback a success call back that will be called when iterating stops.\r\n     * @param breakFunction a break condition (optional)\r\n     * @param timeout timeout settings for the setTimeout function. default - 0.\r\n     * @returns the created async loop object\r\n     */\r\n    public static SyncAsyncForLoop(\r\n        iterations: number,\r\n        syncedIterations: number,\r\n        fn: (iteration: number) => void,\r\n        callback: () => void,\r\n        breakFunction?: () => boolean,\r\n        timeout = 0\r\n    ): AsyncLoop {\r\n        return AsyncLoop.Run(\r\n            Math.ceil(iterations / syncedIterations),\r\n            (loop: AsyncLoop) => {\r\n                if (breakFunction && breakFunction()) {\r\n                    loop.breakLoop();\r\n                } else {\r\n                    setTimeout(() => {\r\n                        for (let i = 0; i < syncedIterations; ++i) {\r\n                            const iteration = loop.index * syncedIterations + i;\r\n                            if (iteration >= iterations) {\r\n                                break;\r\n                            }\r\n                            fn(iteration);\r\n                            if (breakFunction && breakFunction()) {\r\n                                loop.breakLoop();\r\n                                break;\r\n                            }\r\n                        }\r\n                        loop.executeNext();\r\n                    }, timeout);\r\n                }\r\n            },\r\n            callback\r\n        );\r\n    }\r\n}\r\n\r\n// Will only be define if Tools is imported freeing up some space when only engine is required\r\nEngineStore.FallbackTexture =\r\n    \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\";\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}